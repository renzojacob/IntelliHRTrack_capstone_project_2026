{% extends 'employee/base_employee.html' %}

{% block title %}Analytics | IntelliHRTrack{% endblock %}

{% block content %}
<!-- Hero / Title -->
                    <header class="relative overflow-hidden rounded-3xl glass p-6 md:p-8 shadow-glow reveal">
                        <div class="absolute inset-0 opacity-40 animate-shine" style="background-image: linear-gradient(90deg, var(--accent), rgba(255,255,255,0.2), var(--accent)); background-size: 200% 100%;"></div>
                        <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <img class="w-16 h-16 md:w-20 md:h-20 rounded-full object-cover border-4 border-white/50 shadow-lg" src="https://randomuser.me/api/portraits/men/34.jpg" alt="User">
                                    <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-white"></div>
                                </div>
                                <div>
                                    <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">My Analytics</h1>
                                    <p class="text-sm md:text-base text-gray-600 dark:text-gray-300 mt-1">Personal performance insights, trends, and benchmarks</p>
                                    <div class="flex items-center gap-2 mt-2 text-sm">
                                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">Marketing Dept</span>
                                        <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full">ID: EMP-8472</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button id="mobileMenu" class="lg:hidden p-2 rounded-xl glass" aria-label="Open Menu"><iconify-icon icon="ph:list-duotone"></iconify-icon></button>
                                <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded-xl glass text-xs">
                                    <span id="netDot" class="inline-block w-2.5 h-2.5 rounded-full bg-green-500" title="Online"></span>
                                    <span id="headerClock">--:--:--</span>
                                </div>
                                <button id="themeToggleHeader" class="p-2 rounded-xl glass hover:shadow-glow transition">
                                    <iconify-icon icon="ph:sun-dim-duotone" class="hidden dark:inline text-accent"></iconify-icon>
                                    <iconify-icon icon="ph:moon-stars-duotone" class="dark:hidden text-accent"></iconify-icon>
                                </button>
                                <button class="px-3 py-2 rounded-xl glass ripple flex items-center gap-2"><iconify-icon icon="ph:download-simple-duotone"></iconify-icon> Export</button>
                            </div>
                        </div>
                    </header>

                    <!-- KPI Cards -->
                    <div class="glass rounded-3xl p-4 shadow reveal">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
                            <div class="p-4 rounded-2xl bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/30 dark:to-green-900/20 border border-emerald-200 dark:border-emerald-700">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-emerald-700 dark:text-emerald-300">Attendance Rate</span>
                                    <div class="w-10 h-10 rounded-full bg-emerald-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:check-circle-duotone"></iconify-icon></div>
                                </div>
                                <div class="mt-2 text-2xl font-bold text-emerald-900 dark:text-emerald-100">96%</div>
                                <div class="text-xs text-emerald-600 dark:text-emerald-400 mt-1">Consistent over last 3 months</div>
                            </div>
                            <div class="p-4 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/20 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-blue-700 dark:text-blue-300">Total Hours Worked</span>
                                    <div class="w-10 h-10 rounded-full bg-blue-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:timer-duotone"></iconify-icon></div>
                                </div>
                                <div class="mt-2 text-2xl font-bold text-blue-900 dark:text-blue-100">170.5 hrs</div>
                                <div class="text-xs text-blue-700 dark:text-blue-300 mt-1">Last 4 weeks</div>
                            </div>
                            <div class="p-4 rounded-2xl bg-gradient-to-br from-amber-50 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/20 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-amber-700 dark:text-amber-300">Leave Used</span>
                                    <div class="w-10 h-10 rounded-full bg-amber-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:airplane-takeoff-duotone"></iconify-icon></div>
                                </div>
                                <div class="mt-2 text-2xl font-bold text-amber-900 dark:text-amber-100">8 days</div>
                                <div class="text-xs text-amber-700 dark:text-amber-300 mt-1">YTD across types</div>
                            </div>
                            <div class="p-4 rounded-2xl bg-gradient-to-br from-purple-50 to-fuchsia-100 dark:from-purple-900/30 dark:to-fuchsia-900/20 border border-purple-200 dark:border-purple-700">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-purple-700 dark:text-purple-300">Punctuality Score</span>
                                    <div class="w-10 h-10 rounded-full bg-purple-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:alarm-duotone"></iconify-icon></div>
                                </div>
                                <div class="mt-2 text-2xl font-bold text-purple-900 dark:text-purple-100">92</div>
                                <div class="text-xs text-purple-700 dark:text-purple-300 mt-1">On-time arrivals</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Grid balanced -->
                    <section class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div class="space-y-6">
                            <!-- Attendance Performance -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-xl font-bold">Attendance Performance</h2>
                                    <div class="flex items-center gap-2"><button class="px-3 py-2 rounded-xl glass text-sm ripple flex items-center gap-2"><iconify-icon icon="ph:calendar-blank-duotone"></iconify-icon> Last 6 months</button></div>
                                </div>
                                <div class="h-80"><canvas id="attendanceChart"></canvas></div>
                            </div>

                            <!-- Work Hours Comparison -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Work Hours Comparison</h2>
                                <div class="h-64"><canvas id="hoursComparisonChart"></canvas></div>
                                <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                                    <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700">
                                        <div class="font-semibold text-blue-800 dark:text-blue-300">Your Avg</div>
                                        <div class="text-xl font-bold text-blue-600 dark:text-blue-400">42.5h</div>
                                    </div>
                                    <div class="text-center p-3 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700">
                                        <div class="font-semibold text-gray-700 dark:text-gray-300">Standard</div>
                                        <div class="text-xl font-bold text-gray-800 dark:text-gray-100">40h</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payroll Trend Analysis -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Payroll Trend Analysis</h2>
                                <div class="h-64"><canvas id="payrollTrendChart"></canvas></div>
                            </div>

                            <!-- Attendance → Salary Correlation -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Attendance-to-Salary Correlation</h2>
                                <div class="h-64"><canvas id="attendanceSalaryChart"></canvas></div>
                                <div class="mt-3 text-center text-sm text-gray-600 dark:text-gray-400">Correlation Coefficient: <span class="font-bold text-green-600">0.87</span></div>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="space-y-6">
                            <!-- Punctuality Meter -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-6 text-center">Punctuality Score</h2>
                                <div class="flex justify-center">
                                    <div class="relative w-48 h-48">
                                        <svg class="absolute inset-0" viewBox="0 0 120 120">
                                            <circle cx="60" cy="60" r="54" stroke="#e5e7eb" stroke-width="10" fill="none" />
                                            <circle id="punctArc" cx="60" cy="60" r="54" stroke="url(#grad)" stroke-width="10" fill="none" stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292" transform="rotate(-90 60 60)" />
                                            <defs>
                                                <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
                                                    <stop offset="0%" stop-color="#8b5cf6" />
                                                    <stop offset="100%" stop-color="#14b8a6" />
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                        <div class="absolute inset-0 flex items-center justify-center"><div><div class="text-3xl font-extrabold">92</div><div class="text-xs text-gray-500">On-time rate</div></div></div>
                                    </div>
                                </div>
                                <div class="mt-4 text-center text-sm text-gray-600 dark:text-gray-400">On-time arrival rate over last month</div>
                            </div>

                            <!-- Leave Utilization -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Leave Utilization</h2>
                                <div class="h-64"><canvas id="leaveChart"></canvas></div>
                                <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm">
                                    <div class="flex justify-between p-2 rounded-lg bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700"><span>Vacation</span><span class="font-semibold">5</span></div>
                                    <div class="flex justify-between p-2 rounded-lg bg-emerald-50 dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-700"><span>Sick</span><span class="font-semibold">2</span></div>
                                    <div class="flex justify-between p-2 rounded-lg bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700"><span>Emergency</span><span class="font-semibold">1</span></div>
                                </div>
                            </div>

                            <!-- Overtime Analysis -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Overtime Analysis</h2>
                                <div class="h-48"><canvas id="overtimeChart"></canvas></div>
                                <div class="mt-4 text-center text-sm text-gray-600 dark:text-gray-400">Total Overtime This Month <span class="block text-2xl font-bold text-blue-600 dark:text-blue-400">12.5 hours</span></div>
                            </div>

                            <!-- Department Benchmark -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">Department Benchmark</h2>
                                <div class="space-y-3 text-sm">
                                    <div class="p-3 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-700 flex items-center justify-between"><span>Attendance vs Dept Avg</span><span class="font-semibold text-indigo-600 dark:text-indigo-400">+3%</span></div>
                                    <div class="p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-700 flex items-center justify-between"><span>Overtime vs Dept Avg</span><span class="font-semibold text-emerald-600 dark:text-emerald-400">-1.2h</span></div>
                                    <div class="p-3 rounded-xl bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 flex items-center justify-between"><span>Punctuality Rank</span><span class="font-semibold text-amber-600 dark:text-amber-400">Top 15%</span></div>
                                </div>
                            </div>

                            <!-- AI Insights -->
                            <div class="glass rounded-3xl p-6 shadow reveal">
                                <h2 class="text-xl font-bold mb-4">AI Insights &amp; Suggestions</h2>
                                <div class="space-y-3">
                                    <div class="p-4 bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/20 rounded-xl border border-green-200 dark:border-green-700 flex items-start gap-3"><iconify-icon icon="ph:lightbulb-duotone" class="text-emerald-500 mt-1"></iconify-icon><div><p class="font-medium">Shift your deep work earlier</p><p class="text-xs text-emerald-700 dark:text-emerald-400 mt-1">You’re most punctual Mon–Wed mornings. Schedule focus tasks then.</p></div></div>
                                    <div class="p-4 bg-gradient-to-br from-blue-50 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/20 rounded-xl border border-blue-200 dark:border-blue-700 flex items-start gap-3"><iconify-icon icon="ph:chart-line-up-duotone" class="text-blue-500 mt-1"></iconify-icon><div><p class="font-medium">Stabilize week 3 hours</p><p class="text-xs text-blue-700 dark:text-blue-400 mt-1">Hours dip on week 3. Plan breaks to reduce variance.</p></div></div>
                                    <div class="p-4 bg-gradient-to-br from-amber-50 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/20 rounded-xl border border-amber-200 dark:border-amber-700 flex items-start gap-3"><iconify-icon icon="ph:airplane-duotone" class="text-amber-500 mt-1"></iconify-icon><div><p class="font-medium">Use remaining vacation</p><p class="text-xs text-amber-700 dark:text-amber-400 mt-1">5 vacation days available—take one before quarter end.</p></div></div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Additional Features Row -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Performance Consistency -->
                        <div class="glass rounded-3xl p-6 shadow reveal">
                            <h2 class="text-xl font-bold mb-4">Performance Consistency</h2>
                            <div class="h-64"><canvas id="consistencyChart"></canvas></div>
                            <div class="mt-4 flex justify-between items-center text-sm">
                                <div class="text-center"><p class="text-gray-600 dark:text-gray-400">Current Streak</p><p class="text-xl font-bold text-green-600">12 days</p></div>
                                <div class="text-center"><p class="text-gray-600 dark:text-gray-400">Best Streak</p><p class="text-xl font-bold text-blue-600">47 days</p></div>
                                <div class="text-center"><p class="text-gray-600 dark:text-gray-400">Consistency Score</p><p class="text-xl font-bold text-purple-600">88%</p></div>
                            </div>
                        </div>

                        <!-- Leave vs Attendance Correlation -->
                        <div class="glass rounded-3xl p-6 shadow reveal">
                            <h2 class="text-xl font-bold mb-4">Leave vs Attendance Correlation</h2>
                            <div class="h-64"><canvas id="leaveAttendanceChart"></canvas></div>
                            <div class="mt-3 text-center text-sm text-gray-600 dark:text-gray-400">Attendance remains strong even after leaves — good balance.</div>
                        </div>
                    </div>

                    <footer class="pb-8 pt-2 text-xs text-gray-500 dark:text-gray-400 text-center">© IntelliHRTrack • My Analytics</footer>
{% endblock %}

{% block extra_js %}
<script>
                // Active link highlighter (filename based)
                (function(){const file=location.pathname.split('/').pop();document.querySelectorAll('aside nav a').forEach(a=>{const href=a.getAttribute('href');if(!href) return; if(href===file){a.classList.add('gradient-accent','text-white','shadow-glow');a.classList.remove('glass');} else {a.classList.remove('gradient-accent','text-white');if(!a.classList.contains('glass')) a.classList.add('glass');}});})();
                // Theme toggle hookup
                (function(){function save(){localStorage.setItem('ih_theme',document.documentElement.classList.contains('dark')?'dark':'light');}['themeToggle','themeToggleHeader'].forEach(id=>{const el=document.getElementById(id);if(el){el.addEventListener('click',()=>{document.documentElement.classList.toggle('dark');save();});}});})();
                </script>

<script>
                // Theme
                const themeToggle = document.getElementById('themeToggle');
                const themeToggleHeader = document.getElementById('themeToggleHeader');
                function toggleTheme(){ document.documentElement.classList.toggle('dark'); localStorage.setItem('ih_theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light'); }
                themeToggle?.addEventListener('click', toggleTheme); themeToggleHeader?.addEventListener('click', toggleTheme);
                if (localStorage.getItem('ih_theme') === 'dark') document.documentElement.classList.add('dark');

                // Clock & network
                const headerClock = document.getElementById('headerClock'); const netDot = document.getElementById('netDot');
                function updateClock(){ if(headerClock) headerClock.textContent = new Date().toLocaleTimeString(); }
                setInterval(updateClock, 1000); updateClock();
                function updateNet(){ const on = navigator.onLine; if(netDot){ netDot.classList.toggle('bg-green-500', on); netDot.classList.toggle('bg-rose-500', !on); netDot.title = on ? 'Online' : 'Offline'; } }
                window.addEventListener('online', updateNet); window.addEventListener('offline', updateNet); updateNet();

                // Settings panel
                const customizeBtn = document.getElementById('customizeLayout'); const settingsPanel = document.getElementById('settingsPanel'); const closeSettings = document.getElementById('closeSettings'); const saveSettings = document.getElementById('saveSettings'); const resetSettings = document.getElementById('resetSettings'); const motionToggle = document.getElementById('motionToggle');
                function openSettings(){ settingsPanel.classList.remove('hidden'); settingsPanel.classList.add('flex'); }
                function closeSettingsFn(){ settingsPanel.classList.add('hidden'); settingsPanel.classList.remove('flex'); }
                customizeBtn?.addEventListener('click', openSettings); closeSettings?.addEventListener('click', closeSettingsFn); settingsPanel?.addEventListener('click', (e)=>{ if(e.target===settingsPanel) closeSettingsFn(); });
                const accentBtns = Array.from(document.querySelectorAll('#settingsPanel [data-accent]')); const bgBtns = Array.from(document.querySelectorAll('#settingsPanel [data-bg]')); const densityBtns = Array.from(document.querySelectorAll('#settingsPanel [data-density]'));
                function getPrefs(){ try{ return JSON.parse(localStorage.getItem('ih_prefs')) || {}; }catch{ return {}; } }
                function setPrefs(p){ localStorage.setItem('ih_prefs', JSON.stringify(p)); }
                function applyPrefs(p){ if(p.accent) document.documentElement.setAttribute('data-accent', p.accent); if(p.bg) document.documentElement.setAttribute('data-bg', p.bg); document.documentElement.setAttribute('data-density', p.density||'comfortable'); document.documentElement.classList.toggle('reduce-motion', !!p.reduceMotion); if(motionToggle) motionToggle.checked = !!p.reduceMotion; }
                const initPrefs = getPrefs(); applyPrefs(initPrefs);
                accentBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-accent', b.dataset.accent)));
                bgBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-bg', b.dataset.bg)));
                densityBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-density', b.dataset.density)));
                // Extended prefs
                const glassIntensity = document.getElementById('glassIntensity'); const contrastToggle = document.getElementById('contrastToggle'); const sidebarBtns = Array.from(document.querySelectorAll('#settingsPanel [data-sidebar]')); const fontBtns = Array.from(document.querySelectorAll('#settingsPanel [data-font]'));
                function applyGlass(val){ const a=parseFloat(val||'0.6'); document.documentElement.style.setProperty('--card-bg', `rgba(255,255,255,${a})`); document.documentElement.style.setProperty('--card-border', `rgba(255,255,255,${Math.max(0, Math.min(1, a*0.6))})`); }
                function applySidebar(size){ const map={narrow:'14rem',default:'18rem',wide:'22rem'}; document.documentElement.style.setProperty('--sidebar', map[size]||map.default); }
                function applyFont(f){ const s = f==='small'? '0.95rem' : f==='large'? '1.05rem' : '1rem'; document.documentElement.setAttribute('data-font', f||'base'); document.body.style.fontSize = s; }
                function applyPrefsExtended(p){ if(p.glass) applyGlass(p.glass); if(p.sidebar) applySidebar(p.sidebar); if(p.contrast) document.documentElement.classList.toggle('high-contrast', !!p.contrast); if(p.font) applyFont(p.font); if(glassIntensity) glassIntensity.value = p.glass || '0.6'; if(contrastToggle) contrastToggle.checked = !!p.contrast; }
                applyPrefsExtended(getPrefs());
                sidebarBtns.forEach(b=> b.addEventListener('click', ()=> applySidebar(b.dataset.sidebar)));
                fontBtns.forEach(b=> b.addEventListener('click', ()=> applyFont(b.dataset.font)));
                glassIntensity?.addEventListener('input', ()=> applyGlass(glassIntensity.value));
                contrastToggle?.addEventListener('change', ()=> document.documentElement.classList.toggle('high-contrast', contrastToggle.checked));
                saveSettings?.addEventListener('click', ()=>{ const prev=getPrefs(); const p={ accent:document.documentElement.getAttribute('data-accent'), bg:document.documentElement.getAttribute('data-bg'), density:document.documentElement.getAttribute('data-density'), reduceMotion: motionToggle&&motionToggle.checked, glass: glassIntensity?glassIntensity.value:(prev.glass||'0.6'), sidebar:(prev.sidebar)||'default', contrast: contrastToggle?contrastToggle.checked:!!prev.contrast, font: document.documentElement.getAttribute('data-font')||prev.font||'base' }; const activeSidebar = document.activeElement && document.activeElement.getAttribute('data-sidebar'); if(activeSidebar) p.sidebar=activeSidebar; setPrefs(p); applyPrefs(p); applyPrefsExtended(p); closeSettingsFn(); });
                resetSettings?.addEventListener('click', ()=>{ const p={accent:'teal', bg:'gradient', density:'comfortable', reduceMotion:false}; setPrefs(p); applyPrefs(p); });

                // Toasts & back to top
                const toastHost = document.getElementById('toastHost'); function showToast(msg, type='info'){ if(!toastHost) return; const item=document.createElement('div'); item.className=`toast ${type==='success'?'success':type==='warning'?'warn':type==='error'?'error':'info'} glass`; item.innerHTML = `<div class="flex items-start gap-2"><iconify-icon icon="${type==='success'?'ph:check-circle-duotone':type==='warning'?'ph:warning-duotone':type==='error'?'ph:x-circle-duotone':'ph:info-duotone'}" class="mt-0.5 text-accent"></iconify-icon><div class="text-sm">${msg}</div></div>`; toastHost.appendChild(item); setTimeout(()=>{ item.style.transition='opacity .4s ease, transform .4s ease'; item.style.opacity='0'; item.style.transform='translateY(-6px)'; }, 2600); setTimeout(()=> item.remove(), 3100); }
                setTimeout(()=>{ try{ showToast('Analytics dashboard ready','success'); }catch(_){} }, 700);
                const backToTop = document.getElementById('backToTop'); window.addEventListener('scroll', ()=>{ if(window.scrollY>400) backToTop?.classList.remove('hidden'); else backToTop?.classList.add('hidden'); }); backToTop?.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

                // Shortcuts modal
                const shortcutsModal = document.getElementById('shortcutsModal'); const shortcutsBtn = document.getElementById('shortcutsBtn'); const closeShortcuts = document.getElementById('closeShortcuts'); function openShortcuts(){ shortcutsModal.classList.remove('hidden'); shortcutsModal.classList.add('flex'); } function closeShortcutsFn(){ shortcutsModal.classList.add('hidden'); shortcutsModal.classList.remove('flex'); } shortcutsBtn?.addEventListener('click', openShortcuts); closeShortcuts?.addEventListener('click', closeShortcutsFn); shortcutsModal?.addEventListener('click', (e)=>{ if(e.target===shortcutsModal) closeShortcutsFn(); }); document.addEventListener('keydown', (e)=>{ if(e.target && ['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) return; if(e.key.toLowerCase()==='s'){ e.preventDefault(); openSettings(); } if(e.key.toLowerCase()==='t'){ e.preventDefault(); toggleTheme(); } if(e.key==='?'){ e.preventDefault(); openShortcuts(); } });

                // Mobile sidebar
                const mobileMenuBtn = document.getElementById('mobileMenu'); const mobileSidebar = document.getElementById('mobileSidebar'); const mobilePanel = document.getElementById('mobilePanel'); const mobileBackdrop = document.getElementById('mobileBackdrop'); const mobileClose = document.getElementById('closeMobile'); const mobileNavContent = document.getElementById('mobileNavContent');
                function openMobile(){ const desk=document.querySelector('aside nav ul'); if(desk && mobileNavContent){ mobileNavContent.innerHTML=''; mobileNavContent.appendChild(desk.cloneNode(true)); mobileNavContent.querySelectorAll('a').forEach(a=> a.addEventListener('click', ()=> closeMobile())); } mobileSidebar.classList.remove('hidden'); requestAnimationFrame(()=> mobilePanel.classList.remove('-translate-x-full')); }
                function closeMobile(){ mobilePanel.classList.add('-translate-x-full'); setTimeout(()=> mobileSidebar.classList.add('hidden'), 250); }
                mobileMenuBtn?.addEventListener('click', openMobile); mobileBackdrop?.addEventListener('click', closeMobile); mobileClose?.addEventListener('click', closeMobile);

                // Charts
                try {
                    // Attendance Performance
                    const attendanceEl = document.getElementById('attendanceChart');
                    const attendanceCtx = attendanceEl ? attendanceEl.getContext('2d') : null;
                    if (attendanceCtx) {
                        new Chart(attendanceCtx, {
                            type: 'bar',
                            data: {
                                labels: ['Jan','Feb','Mar','Apr','May','Jun'],
                                datasets: [
                                    { label: 'Days Present', data: [22,20,23,21,22,21], backgroundColor: 'rgba(16,185,129,0.7)' },
                                    { label: 'Absences', data: [0,2,0,1,0,1], backgroundColor: 'rgba(239,68,68,0.7)' },
                                    { label: 'Late Arrivals', data: [1,3,1,2,1,2], backgroundColor: 'rgba(245,158,11,0.7)' }
                                ]
                            },
                            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, x: { grid: { display:false } } } }
                        });
                    }

                    // Work Hours Comparison
                    const hoursEl = document.getElementById('hoursComparisonChart');
                    const hoursCtx = hoursEl ? hoursEl.getContext('2d') : null;
                    if (hoursCtx) {
                        new Chart(hoursCtx, {
                            type: 'line',
                            data: {
                                labels: ['Week 1','Week 2','Week 3','Week 4'],
                                datasets: [
                                    { label: 'Your Hours', data: [42,45,40,43], borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', fill: true, tension: 0.4 },
                                    { label: 'Standard Hours', data: [40,40,40,40], borderColor: '#9ca3af', borderDash: [5,5], backgroundColor: 'transparent', fill: false, tension: 0.4 }
                                ]
                            },
                            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false }, x: { grid: { display:false } } } }
                        });
                    }

                    // Leave Utilization
                    const leaveEl = document.getElementById('leaveChart');
                    const leaveCtx = leaveEl ? leaveEl.getContext('2d') : null;
                    if (leaveCtx) {
                        new Chart(leaveCtx, {
                            type: 'doughnut',
                            data: { labels: ['Vacation','Sick','Emergency'], datasets: [{ data: [5,2,1], backgroundColor: ['#3b82f6','#10b981','#eab308'], borderWidth: 0 }] },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                        });
                    }

                    // Overtime Analysis
                    const overtimeEl = document.getElementById('overtimeChart');
                    const overtimeCtx = overtimeEl ? overtimeEl.getContext('2d') : null;
                    if (overtimeCtx) {
                        new Chart(overtimeCtx, {
                            type: 'line',
                            data: { labels: ['Jan','Feb','Mar','Apr','May','Jun'], datasets: [{ label: 'Overtime Hours', data: [8,12,6,10,15,12.5], borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', fill: true, tension: 0.4 }] },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true }, x: { grid: { display:false } } } }
                        });
                    }

                    // Payroll Trend
                    const payrollEl = document.getElementById('payrollTrendChart');
                    const payrollCtx = payrollEl ? payrollEl.getContext('2d') : null;
                    if (payrollCtx) {
                        new Chart(payrollCtx, {
                            type: 'line',
                            data: { labels: ['Jan','Feb','Mar','Apr','May','Jun'], datasets: [{ label: 'Net Salary', data: [32000,32500,33200,33550,34620,37075], borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.1)', fill: true, tension: 0.4 }] },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false }, x: { grid: { display:false } } } }
                        });
                    }

                    // Attendance to Salary Correlation
                    const attSalEl = document.getElementById('attendanceSalaryChart');
                    const attSalCtx = attSalEl ? attSalEl.getContext('2d') : null;
                    if (attSalCtx) {
                        new Chart(attSalCtx, {
                            type: 'scatter',
                            data: { datasets: [{ label: 'Attendance vs Salary', data: [ {x:95,y:32000},{x:92,y:31500},{x:98,y:33500},{x:96,y:32500},{x:94,y:32200},{x:97,y:33200},{x:96,y:33550},{x:98,y:34620},{x:99,y:37075} ], backgroundColor: 'rgba(59,130,246,0.7)' }] },
                            options: { responsive: true, maintainAspectRatio: false, scales: { x: {}, y: {} } }
                        });
                    }

                    // Performance Consistency
                    const consEl = document.getElementById('consistencyChart');
                    const consCtx = consEl ? consEl.getContext('2d') : null;
                    if (consCtx) {
                        new Chart(consCtx, {
                            type: 'line',
                            data: { labels: ['Jan','Feb','Mar','Apr','May','Jun'], datasets: [{ label: 'Consistency Index', data: [82,85,88,84,87,88], borderColor: '#8b5cf6', backgroundColor: 'rgba(139,92,246,0.1)', fill: true, tension: 0.4 }] },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                        });
                    }

                    // Leave vs Attendance
                    const leaveAttEl = document.getElementById('leaveAttendanceChart');
                    const leaveAttCtx = leaveAttEl ? leaveAttEl.getContext('2d') : null;
                    if (leaveAttCtx) {
                        new Chart(leaveAttCtx, {
                            type: 'bar',
                            data: {
                                labels: ['Jan','Feb','Mar','Apr','May','Jun'],
                                datasets: [
                                    { label: 'Attendance %', type:'line', data: [96,92,98,96,94,97], borderColor: '#10b981', backgroundColor: 'transparent', yAxisID: 'y1', tension:0.3, order: 1 },
                                    { label: 'Leave Days', data: [1,2,1,2,0,2], backgroundColor: 'rgba(59,130,246,0.6)', yAxisID: 'y', order: 2 }
                                ]
                            },
                            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, y1: { position: 'right', beginAtZero: false, min: 80, max: 100, grid: { drawOnChartArea: false } }, x: { grid: { display:false } } } }
                        });
                    }
                } catch(e){}

                // Punctuality ring animation
                (function(){ const el=document.getElementById('punctArc'); if(!el) return; const total=339.292; const pct=92; const offset=total*(1-pct/100); requestAnimationFrame(()=>{ el.style.transition='stroke-dashoffset 1s ease'; el.style.strokeDashoffset=String(offset); }); })();

                // Micro-interactions & reveals
                Array.from(document.querySelectorAll('.glass')).forEach(el=> el.classList.add('hover-lift'));
                Array.from(document.querySelectorAll('button')).forEach(el=> el.classList.add('ripple'));
                const revealables = Array.from(document.querySelectorAll('.reveal')); const io = new IntersectionObserver(entries=>{ entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('in-view'); io.unobserve(en.target); } }); }, { threshold: 0.12 }); revealables.forEach(el=> io.observe(el));
            </script>
{% endblock %}
