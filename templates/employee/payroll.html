{% extends 'employee/base_employee.html' %}

{% block title %}Payroll | IntelliHRTrack{% endblock %}

{% block content %}
<!-- Hero / Title -->
            <header class="relative overflow-hidden rounded-3xl glass p-6 md:p-8 shadow-glow reveal">
                <div class="absolute inset-0 opacity-40 animate-shine" style="background-image: linear-gradient(90deg, var(--accent), rgba(255,255,255,0.2), var(--accent)); background-size: 200% 100%;"></div>
                <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <img class="w-16 h-16 md:w-20 md:h-20 rounded-full object-cover border-4 border-white/50 shadow-lg" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Renzo">
                            <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Payroll &amp; Finance</h1>
                            <p class="text-sm md:text-base text-gray-600 dark:text-gray-300 mt-1">View payslips, breakdowns, and financial insights</p>
                            <div class="flex items-center gap-2 mt-2 text-sm">
                                <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">ID: EMP-8472</span>
                                <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full">Sales Department</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <button id="mobileMenu" class="lg:hidden p-2 rounded-xl glass" aria-label="Open Menu"><iconify-icon icon="ph:list-duotone"></iconify-icon></button>
                        <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded-xl glass text-xs">
                            <span id="netDot" class="inline-block w-2.5 h-2.5 rounded-full bg-green-500" title="Online"></span>
                            <span id="headerClock">--:--:--</span>
                        </div>
                        <button id="themeToggleHeader" class="p-2 rounded-xl glass hover:shadow-glow transition">
                            <iconify-icon icon="ph:sun-dim-duotone" class="hidden dark:inline text-accent"></iconify-icon>
                            <iconify-icon icon="ph:moon-stars-duotone" class="dark:hidden text-accent"></iconify-icon>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Quick Summary Cards -->
            <div class="glass rounded-3xl p-4 shadow reveal">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/20 border border-blue-200 dark:border-blue-700">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-700 dark:text-blue-300">Total Gross Pay</span>
                            <div class="w-10 h-10 rounded-full bg-blue-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:money-duotone"></iconify-icon></div>
                        </div>
                        <div class="mt-2 text-2xl font-bold text-blue-900 dark:text-blue-100">₱45,820.00</div>
                        <div class="text-xs text-green-600 dark:text-green-400 mt-1 flex items-center gap-1"><iconify-icon icon="ph:trend-up-duotone"></iconify-icon> 5.2% from last period</div>
                    </div>
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-rose-50 to-red-100 dark:from-rose-900/30 dark:to-red-900/20 border border-rose-200 dark:border-rose-700">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-rose-700 dark:text-rose-300">Total Deductions</span>
                            <div class="w-10 h-10 rounded-full bg-rose-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:file-text-duotone"></iconify-icon></div>
                        </div>
                        <div class="mt-2 text-2xl font-bold text-rose-900 dark:text-rose-100">₱8,745.00</div>
                        <div class="text-xs text-rose-600 dark:text-rose-400 mt-1 flex items-center gap-1"><iconify-icon icon="ph:trend-down-duotone"></iconify-icon> 2.1% from last period</div>
                    </div>
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/30 dark:to-green-900/20 border border-emerald-200 dark:border-emerald-700">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-emerald-700 dark:text-emerald-300">Net Pay</span>
                            <div class="w-10 h-10 rounded-full bg-emerald-500/90 text-white flex items-center justify-center"><iconify-icon icon="ph:wallet-duotone"></iconify-icon></div>
                        </div>
                        <div class="mt-2 text-2xl font-bold text-emerald-900 dark:text-emerald-100">₱37,075.00</div>
                        <div class="text-xs text-emerald-600 dark:text-emerald-400 mt-1 flex items-center gap-1"><iconify-icon icon="ph:trend-up-duotone"></iconify-icon> 7.8% from last period</div>
                    </div>
                </div>
            </div>

            <!-- Main Grid balanced -->
            <section class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Current Payslip -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Current Payslip</h2>
                            <div class="flex items-center gap-2">
                                <button class="px-3 py-2 rounded-xl glass text-sm flex items-center gap-2 ripple"><iconify-icon icon="ph:file-pdf-duotone"></iconify-icon> PDF</button>
                                <button class="px-3 py-2 rounded-xl glass text-sm flex items-center gap-2 ripple"><iconify-icon icon="ph:file-csv-duotone"></iconify-icon> CSV</button>
                            </div>
                        </div>
                        <div class="rounded-2xl border border-gray-200 dark:border-gray-700 p-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h3 class="font-semibold">Earnings</h3>
                                    <div class="mt-2 space-y-2 text-sm">
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Basic Salary</span><span class="font-medium">₱35,000.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Overtime</span><span class="font-medium">₱5,200.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Allowances</span><span class="font-medium">₱3,500.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Bonus</span><span class="font-medium">₱2,120.00</span></div>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="font-semibold">Deductions</h3>
                                    <div class="mt-2 space-y-2 text-sm">
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Tax</span><span class="font-medium">₱4,850.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">SSS</span><span class="font-medium">₱1,200.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">PhilHealth</span><span class="font-medium">₱900.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Pag-IBIG</span><span class="font-medium">₱100.00</span></div>
                                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Late Penalties</span><span class="font-medium">₱695.00</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between">
                                <span class="text-sm font-medium">Net Pay</span>
                                <span class="text-lg font-bold">₱37,075.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll History -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Payroll History</h2>
                            <button class="px-3 py-2 rounded-xl glass text-sm ripple flex items-center gap-2"><iconify-icon icon="ph:download-simple-duotone"></iconify-icon> Export</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="py-3 text-left text-gray-600 dark:text-gray-400">Period</th>
                                        <th class="py-3 text-left text-gray-600 dark:text-gray-400">Date Released</th>
                                        <th class="py-3 text-right text-gray-600 dark:text-gray-400">Gross Pay</th>
                                        <th class="py-3 text-right text-gray-600 dark:text-gray-400">Deductions</th>
                                        <th class="py-3 text-right text-gray-600 dark:text-gray-400">Net Pay</th>
                                        <th class="py-3 text-right text-gray-600 dark:text-gray-400">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">
                                        <td class="py-3">Nov 1-15, 2023</td>
                                        <td class="py-3">Nov 16, 2023</td>
                                        <td class="py-3 text-right">₱45,820.00</td>
                                        <td class="py-3 text-right">₱8,745.00</td>
                                        <td class="py-3 text-right font-semibold">₱37,075.00</td>
                                        <td class="py-3 text-right"><button class="text-accent hover:underline text-xs">View</button></td>
                                    </tr>
                                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">
                                        <td class="py-3">Oct 16-31, 2023</td>
                                        <td class="py-3">Nov 1, 2023</td>
                                        <td class="py-3 text-right">₱43,550.00</td>
                                        <td class="py-3 text-right">₱8,930.00</td>
                                        <td class="py-3 text-right font-semibold">₱34,620.00</td>
                                        <td class="py-3 text-right"><button class="text-accent hover:underline text-xs">View</button></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                                        <td class="py-3">Oct 1-15, 2023</td>
                                        <td class="py-3">Oct 16, 2023</td>
                                        <td class="py-3 text-right">₱42,100.00</td>
                                        <td class="py-3 text-right">₱8,550.00</td>
                                        <td class="py-3 text-right font-semibold">₱33,550.00</td>
                                        <td class="py-3 text-right"><button class="text-accent hover:underline text-xs">View</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- AI Payroll Insights (moved from right to left for balance) -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">AI Payroll Insights</h2>
                        <div class="space-y-3">
                            <div class="p-4 bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/30 dark:to-green-900/20 rounded-xl border border-emerald-200 dark:border-emerald-700 flex items-start gap-3"><iconify-icon icon="ph:chart-line-up-duotone" class="text-emerald-500 mt-1"></iconify-icon><div><p class="font-medium text-emerald-800 dark:text-emerald-300">Net pay increased by 7.8% vs previous cutoff</p><p class="text-xs text-emerald-600 dark:text-emerald-400 mt-1">Main driver: +12% overtime hours.</p></div></div>
                            <div class="p-4 bg-gradient-to-br from-blue-50 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/20 rounded-xl border border-blue-200 dark:border-blue-700 flex items-start gap-3"><iconify-icon icon="ph:clock-countdown-duotone" class="text-blue-500 mt-1"></iconify-icon><div><p class="font-medium text-blue-800 dark:text-blue-300">35% fewer late deductions this month</p><p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Great punctuality improvement.</p></div></div>
                            <div class="p-4 bg-gradient-to-br from-amber-50 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/20 rounded-xl border border-amber-200 dark:border-amber-700 flex items-start gap-3"><iconify-icon icon="ph:lightbulb-duotone" class="text-amber-500 mt-1"></iconify-icon><div><p class="font-medium text-amber-800 dark:text-amber-300">Tax contribution decreased by ₱320</p><p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Reflects updated tax brackets.</p></div></div>
                        </div>
                    </div>

                    <!-- Notifications (moved from right to left for balance) -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Notifications</h2>
                            <span class="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs rounded-full">3 new</span>
                        </div>
                        <div class="space-y-3 max-h-60 overflow-y-auto fancy-scroll">
                            <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                                <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white flex-shrink-0"><iconify-icon icon="ph:file-text-duotone"></iconify-icon></div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium">New Payslip Available</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Your payslip for Nov 1-15, 2023 is ready.</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">2 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 bg-green-50 dark:bg-green-900/30 rounded-xl">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white flex-shrink-0"><iconify-icon icon="ph:gift-duotone"></iconify-icon></div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium">Bonus Credited</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Your Q3 performance bonus has been credited.</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">1 day ago</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 bg-amber-50 dark:bg-amber-900/30 rounded-xl">
                                <div class="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center text-white flex-shrink-0"><iconify-icon icon="ph:warning-duotone"></iconify-icon></div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium">Payroll Adjustment</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Tax calculation adjusted based on new brackets.</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">3 days ago</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll Certificate (moved from right to left for balance) -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Payroll Certificate</h2>
                            <button class="px-3 py-2 rounded-xl bg-rose-500 hover:bg-rose-600 text-white ripple flex items-center gap-2"><iconify-icon icon="ph:file-pdf-duotone"></iconify-icon> Generate PDF</button>
                        </div>
                        <div class="p-6 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl text-center">
                            <iconify-icon icon="ph:certificate-duotone" class="text-4xl text-gray-400 dark:text-gray-500 mb-3"></iconify-icon>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Generate an official payroll certificate for loans, visa, or other purposes.</p>
                            <div class="mt-4">
                                <label class="block text-sm mb-1">Certificate Period</label>
                                <select class="w-full rounded-xl glass py-2 px-3">
                                    <option>Last 3 Months</option>
                                    <option>Last 6 Months</option>
                                    <option>Year to Date</option>
                                    <option>Custom Range</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Tax & Contributions -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">Tax &amp; Contributions</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                            <div class="p-4 bg-indigo-50 dark:bg-indigo-900/30 rounded-xl border border-indigo-200 dark:border-indigo-700">
                                <p class="font-semibold text-indigo-800 dark:text-indigo-300">SSS</p>
                                <p class="text-gray-700 dark:text-gray-300">Contribution: ₱1,200.00</p>
                                <p class="text-xs text-gray-500">SSS No: 03-1234567-8</p>
                            </div>
                            <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl border border-blue-200 dark:border-blue-700">
                                <p class="font-semibold text-blue-800 dark:text-blue-300">PhilHealth</p>
                                <p class="text-gray-700 dark:text-gray-300">Contribution: ₱900.00</p>
                                <p class="text-xs text-gray-500">PIN: 03-123456789-0</p>
                            </div>
                            <div class="p-4 bg-emerald-50 dark:bg-emerald-900/30 rounded-xl border border-emerald-200 dark:border-emerald-700">
                                <p class="font-semibold text-emerald-800 dark:text-emerald-300">Pag-IBIG</p>
                                <p class="text-gray-700 dark:text-gray-300">Contribution: ₱100.00</p>
                                <p class="text-xs text-gray-500">MID: 1234-5678-9012</p>
                            </div>
                            <div class="p-4 bg-amber-50 dark:bg-amber-900/30 rounded-xl border border-amber-200 dark:border-amber-700">
                                <p class="font-semibold text-amber-800 dark:text-amber-300">Income Tax</p>
                                <p class="text-gray-700 dark:text-gray-300">Withholding Tax: ₱4,850.00</p>
                                <p class="text-xs text-gray-500">TIN: 123-456-789-000</p>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll Dispute moved to Right Column for balance -->
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Deduction Breakdown -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">Deduction Breakdown</h2>
                        <div class="h-64"><canvas id="deductionsChart"></canvas></div>
                        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                            <div class="flex justify-between"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span> Tax</span><span class="font-medium">₱4,850.00</span></div>
                            <div class="flex justify-between"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> SSS</span><span class="font-medium">₱1,200.00</span></div>
                            <div class="flex justify-between"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> PhilHealth</span><span class="font-medium">₱900.00</span></div>
                            <div class="flex justify-between"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Pag-IBIG</span><span class="font-medium">₱100.00</span></div>
                            <div class="flex justify-between"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-purple-500"></span> Late Penalties</span><span class="font-medium">₱695.00</span></div>
                        </div>
                    </div>

                    <!-- Salary Projection -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">Salary Projection</h2>
                        <div class="h-64"><canvas id="salaryProjectionChart"></canvas></div>
                        <div class="mt-4 text-center">
                            <p class="text-gray-600 dark:text-gray-400">Based on current trends, projected next period is</p>
                            <p class="text-2xl font-bold text-green-600 dark:text-green-400 mt-1">₱38,240.00</p>
                        </div>
                    </div>

                    <!-- Allowances & Bonuses -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">Allowances &amp; Bonuses</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 rounded-xl bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700"><div><p class="font-semibold">Transportation Allowance</p><p class="text-xs text-gray-500">Monthly</p></div><span class="font-bold text-blue-600 dark:text-blue-400">₱2,000.00</span></div>
                            <div class="flex justify-between items-center p-3 rounded-xl bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700"><div><p class="font-semibold">Meal Allowance</p><p class="text-xs text-gray-500">Monthly</p></div><span class="font-bold text-green-600 dark:text-green-400">₱1,500.00</span></div>
                            <div class="flex justify-between items-center p-3 rounded-xl bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700"><div><p class="font-semibold">Performance Bonus</p><p class="text-xs text-gray-500">Q3 2023</p></div><span class="font-bold text-amber-600 dark:text-amber-400">₱2,120.00</span></div>
                        </div>
                    </div>

                    <!-- Comparison Chart -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">This Period vs Last Period</h2>
                        <div class="h-64"><canvas id="comparisonChart"></canvas></div>
                    </div>

                    <!-- Notifications, Payroll Certificate, and AI Payroll Insights moved to Left Column for balance -->

                    <!-- Payroll Dispute (moved from left) -->
                    <div class="glass rounded-3xl p-6 shadow reveal">
                        <h2 class="text-xl font-bold mb-4">Payroll Dispute</h2>
                        <form class="space-y-4">
                            <div>
                                <label class="block text-sm mb-1">Payroll Period</label>
                                <select class="w-full rounded-xl glass py-2 px-3">
                                    <option>Nov 1-15, 2023</option>
                                    <option>Oct 16-31, 2023</option>
                                    <option>Oct 1-15, 2023</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">Issue Type</label>
                                <select class="w-full rounded-xl glass py-2 px-3">
                                    <option>Missing Allowance</option>
                                    <option>Incorrect Deduction</option>
                                    <option>Missing Overtime</option>
                                    <option>Tax Calculation Error</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">Description</label>
                                <textarea rows="3" class="w-full rounded-xl glass py-2 px-3" placeholder="Please describe the issue in detail..."></textarea>
                            </div>
                            <button class="w-full px-4 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl font-medium transition-all ripple">Submit Dispute Request</button>
                        </form>
                    </div>
                </div>
            </section>

            <footer class="pb-8 pt-2 text-xs text-gray-500 dark:text-gray-400 text-center">© IntelliHRTrack • Payroll Portal</footer>
{% endblock %}

{% block extra_js %}
<script>
        // Active link highlighter (filename based)
        (function(){const file=location.pathname.split('/').pop();document.querySelectorAll('aside nav a').forEach(a=>{const href=a.getAttribute('href');if(!href) return; if(href===file){a.classList.add('gradient-accent','text-white','shadow-glow');a.classList.remove('glass');} else {a.classList.remove('gradient-accent','text-white');if(!a.classList.contains('glass')) a.classList.add('glass');}});})();
        // Theme toggle hookup
        (function(){function save(){localStorage.setItem('ih_theme',document.documentElement.classList.contains('dark')?'dark':'light');}['themeToggle','themeToggleHeader'].forEach(id=>{const el=document.getElementById(id);if(el){el.addEventListener('click',()=>{document.documentElement.classList.toggle('dark');save();});}});})();
        </script>

<script>
        // Theme
        const themeToggle = document.getElementById('themeToggle');
        const themeToggleHeader = document.getElementById('themeToggleHeader');
        function toggleTheme(){ document.documentElement.classList.toggle('dark'); localStorage.setItem('ih_theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light'); }
        themeToggle?.addEventListener('click', toggleTheme); themeToggleHeader?.addEventListener('click', toggleTheme);
        if (localStorage.getItem('ih_theme') === 'dark') document.documentElement.classList.add('dark');

        // Clock & network
        const headerClock = document.getElementById('headerClock'); const netDot = document.getElementById('netDot');
        function updateClock(){ if(headerClock) headerClock.textContent = new Date().toLocaleTimeString(); }
        setInterval(updateClock, 1000); updateClock();
        function updateNet(){ const on = navigator.onLine; if(netDot){ netDot.classList.toggle('bg-green-500', on); netDot.classList.toggle('bg-rose-500', !on); netDot.title = on ? 'Online' : 'Offline'; } }
        window.addEventListener('online', updateNet); window.addEventListener('offline', updateNet); updateNet();

        // Settings panel
        const customizeBtn = document.getElementById('customizeLayout'); const settingsPanel = document.getElementById('settingsPanel'); const closeSettings = document.getElementById('closeSettings'); const saveSettings = document.getElementById('saveSettings'); const resetSettings = document.getElementById('resetSettings'); const motionToggle = document.getElementById('motionToggle');
        function openSettings(){ settingsPanel.classList.remove('hidden'); settingsPanel.classList.add('flex'); }
        function closeSettingsFn(){ settingsPanel.classList.add('hidden'); settingsPanel.classList.remove('flex'); }
        customizeBtn?.addEventListener('click', openSettings); closeSettings?.addEventListener('click', closeSettingsFn); settingsPanel?.addEventListener('click', (e)=>{ if(e.target===settingsPanel) closeSettingsFn(); });
        const accentBtns = Array.from(document.querySelectorAll('#settingsPanel [data-accent]')); const bgBtns = Array.from(document.querySelectorAll('#settingsPanel [data-bg]')); const densityBtns = Array.from(document.querySelectorAll('#settingsPanel [data-density]'));
        function getPrefs(){ try{ return JSON.parse(localStorage.getItem('ih_prefs')) || {}; }catch{ return {}; } }
        function setPrefs(p){ localStorage.setItem('ih_prefs', JSON.stringify(p)); }
        function applyPrefs(p){ if(p.accent) document.documentElement.setAttribute('data-accent', p.accent); if(p.bg) document.documentElement.setAttribute('data-bg', p.bg); document.documentElement.setAttribute('data-density', p.density||'comfortable'); document.documentElement.classList.toggle('reduce-motion', !!p.reduceMotion); if(motionToggle) motionToggle.checked = !!p.reduceMotion; }
        const initPrefs = getPrefs(); applyPrefs(initPrefs);
        accentBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-accent', b.dataset.accent)));
        bgBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-bg', b.dataset.bg)));
        densityBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-density', b.dataset.density)));
        // Extended prefs
        const glassIntensity = document.getElementById('glassIntensity'); const contrastToggle = document.getElementById('contrastToggle'); const sidebarBtns = Array.from(document.querySelectorAll('#settingsPanel [data-sidebar]')); const fontBtns = Array.from(document.querySelectorAll('#settingsPanel [data-font]'));
        function applyGlass(val){ const a=parseFloat(val||'0.6'); document.documentElement.style.setProperty('--card-bg', `rgba(255,255,255,${a})`); document.documentElement.style.setProperty('--card-border', `rgba(255,255,255,${Math.max(0, Math.min(1, a*0.6))})`); }
        function applySidebar(size){ const map={narrow:'14rem',default:'18rem',wide:'22rem'}; document.documentElement.style.setProperty('--sidebar', map[size]||map.default); }
        function applyFont(f){ const s = f==='small'? '0.95rem' : f==='large'? '1.05rem' : '1rem'; document.documentElement.setAttribute('data-font', f||'base'); document.body.style.fontSize = s; }
        function applyPrefsExtended(p){ if(p.glass) applyGlass(p.glass); if(p.sidebar) applySidebar(p.sidebar); if(p.contrast) document.documentElement.classList.toggle('high-contrast', !!p.contrast); if(p.font) applyFont(p.font); if(glassIntensity) glassIntensity.value = p.glass || '0.6'; if(contrastToggle) contrastToggle.checked = !!p.contrast; }
        applyPrefsExtended(getPrefs());
        sidebarBtns.forEach(b=> b.addEventListener('click', ()=> applySidebar(b.dataset.sidebar)));
        fontBtns.forEach(b=> b.addEventListener('click', ()=> applyFont(b.dataset.font)));
        glassIntensity?.addEventListener('input', ()=> applyGlass(glassIntensity.value));
        contrastToggle?.addEventListener('change', ()=> document.documentElement.classList.toggle('high-contrast', contrastToggle.checked));
        saveSettings?.addEventListener('click', ()=>{ const prev=getPrefs(); const p={ accent:document.documentElement.getAttribute('data-accent'), bg:document.documentElement.getAttribute('data-bg'), density:document.documentElement.getAttribute('data-density'), reduceMotion: motionToggle&&motionToggle.checked, glass: glassIntensity?glassIntensity.value:(prev.glass||'0.6'), sidebar:(prev.sidebar)||'default', contrast: contrastToggle?contrastToggle.checked:!!prev.contrast, font: document.documentElement.getAttribute('data-font')||prev.font||'base' }; const activeSidebar = document.activeElement && document.activeElement.getAttribute('data-sidebar'); if(activeSidebar) p.sidebar=activeSidebar; setPrefs(p); applyPrefs(p); applyPrefsExtended(p); closeSettingsFn(); });
        resetSettings?.addEventListener('click', ()=>{ const p={accent:'teal', bg:'gradient', density:'comfortable', reduceMotion:false}; setPrefs(p); applyPrefs(p); });

        // Toasts & back to top
        const toastHost = document.getElementById('toastHost'); function showToast(msg, type='info'){ if(!toastHost) return; const item=document.createElement('div'); item.className=`toast ${type==='success'?'success':type==='warning'?'warn':type==='error'?'error':'info'} glass`; item.innerHTML = `<div class="flex items-start gap-2"><iconify-icon icon="${type==='success'?'ph:check-circle-duotone':type==='warning'?'ph:warning-duotone':type==='error'?'ph:x-circle-duotone':'ph:info-duotone'}" class="mt-0.5 text-accent"></iconify-icon><div class="text-sm">${msg}</div></div>`; toastHost.appendChild(item); setTimeout(()=>{ item.style.transition='opacity .4s ease, transform .4s ease'; item.style.opacity='0'; item.style.transform='translateY(-6px)'; }, 2600); setTimeout(()=> item.remove(), 3100); }
        setTimeout(()=>{ try{ showToast('Payroll dashboard ready','success'); }catch(_){} }, 700);
        const backToTop = document.getElementById('backToTop'); window.addEventListener('scroll', ()=>{ if(window.scrollY>400) backToTop?.classList.remove('hidden'); else backToTop?.classList.add('hidden'); }); backToTop?.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

        // Shortcuts modal
        const shortcutsModal = document.getElementById('shortcutsModal'); const shortcutsBtn = document.getElementById('shortcutsBtn'); const closeShortcuts = document.getElementById('closeShortcuts'); function openShortcuts(){ shortcutsModal.classList.remove('hidden'); shortcutsModal.classList.add('flex'); } function closeShortcutsFn(){ shortcutsModal.classList.add('hidden'); shortcutsModal.classList.remove('flex'); } shortcutsBtn?.addEventListener('click', openShortcuts); closeShortcuts?.addEventListener('click', closeShortcutsFn); shortcutsModal?.addEventListener('click', (e)=>{ if(e.target===shortcutsModal) closeShortcutsFn(); }); document.addEventListener('keydown', (e)=>{ if(e.target && ['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) return; if(e.key.toLowerCase()==='s'){ e.preventDefault(); openSettings(); } if(e.key.toLowerCase()==='t'){ e.preventDefault(); toggleTheme(); } if(e.key==='?'){ e.preventDefault(); openShortcuts(); } });

        // Mobile sidebar
        const mobileMenuBtn = document.getElementById('mobileMenu'); const mobileSidebar = document.getElementById('mobileSidebar'); const mobilePanel = document.getElementById('mobilePanel'); const mobileBackdrop = document.getElementById('mobileBackdrop'); const mobileClose = document.getElementById('closeMobile'); const mobileNavContent = document.getElementById('mobileNavContent');
        function openMobile(){ const desk=document.querySelector('aside nav ul'); if(desk && mobileNavContent){ mobileNavContent.innerHTML=''; mobileNavContent.appendChild(desk.cloneNode(true)); mobileNavContent.querySelectorAll('a').forEach(a=> a.addEventListener('click', ()=> closeMobile())); } mobileSidebar.classList.remove('hidden'); requestAnimationFrame(()=> mobilePanel.classList.remove('-translate-x-full')); }
        function closeMobile(){ mobilePanel.classList.add('-translate-x-full'); setTimeout(()=> mobileSidebar.classList.add('hidden'), 250); }
        mobileMenuBtn?.addEventListener('click', openMobile); mobileBackdrop?.addEventListener('click', closeMobile); mobileClose?.addEventListener('click', closeMobile);

        // Charts
            try {
                const deductionsEl = document.getElementById('deductionsChart');
                const deductionsCtx = deductionsEl ? deductionsEl.getContext('2d') : null;
                if (deductionsCtx) {
                    new Chart(deductionsCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Tax', 'SSS', 'PhilHealth', 'Pag-IBIG', 'Late Penalties'],
                            datasets: [
                                {
                                    data: [4850, 1200, 900, 100, 695],
                                    backgroundColor: ['#3b82f6', '#ef4444', '#eab308', '#10b981', '#8b5cf6'],
                                    borderWidth: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                }

                const projectionEl = document.getElementById('salaryProjectionChart');
                const projectionCtx = projectionEl ? projectionEl.getContext('2d') : null;
                if (projectionCtx) {
                    new Chart(projectionCtx, {
                        type: 'line',
                        data: {
                            labels: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                            datasets: [
                                {
                                    label: 'Net Pay',
                                    data: [32500, 33200, 33550, 34620, 37075, 38240],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: false },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                }

                const comparisonEl = document.getElementById('comparisonChart');
                const comparisonCtx = comparisonEl ? comparisonEl.getContext('2d') : null;
                if (comparisonCtx) {
                    new Chart(comparisonCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Gross Pay', 'Deductions', 'Net Pay'],
                            datasets: [
                                { label: 'Last Period', data: [43550, 8930, 34620], backgroundColor: 'rgba(107, 114, 128, 0.7)' },
                                { label: 'This Period', data: [45820, 8745, 37075], backgroundColor: 'rgba(59, 130, 246, 0.7)' }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                }
            } catch (e) {}

        // Micro-interactions & reveals
        Array.from(document.querySelectorAll('.glass')).forEach(el=> el.classList.add('hover-lift'));
        Array.from(document.querySelectorAll('button')).forEach(el=> el.classList.add('ripple'));
        const revealables = Array.from(document.querySelectorAll('.reveal')); const io = new IntersectionObserver(entries=>{ entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('in-view'); io.unobserve(en.target); } }); }, { threshold: 0.12 }); revealables.forEach(el=> io.observe(el));
    </script>
{% endblock %}
