{% extends 'admin/base_admin.html' %}

{% block title %}IntelliHRTrack ‚Äî Module 5: Leave & Absences{% endblock %}

{% block extra_head %}
<style>
		:root { --accent:#14b8a6; --accent-to:#0ea5a0; --card-bg:rgba(255,255,255,0.6); --card-border:rgba(255,255,255,0.35);
			--noise:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.035"/></svg>'); }
		html[data-accent="teal"] { --accent:#14b8a6; --accent-to:#0ea5a0; }
		html[data-accent="purple"] { --accent:#8b5cf6; --accent-to:#7c3aed; }
		html[data-accent="rose"] { --accent:#f43f5e; --accent-to:#e11d48; }
		html[data-accent="amber"] { --accent:#f59e0b; --accent-to:#d97706; }
		html[data-bg="gradient"] body::before { content:""; position:fixed; inset:0; z-index:-2; background:
			radial-gradient(800px 400px at 10% -10%, rgba(59,130,246,0.15), transparent 60%),
			radial-gradient(600px 300px at 120% 0%, rgba(20,184,166,0.18), transparent 60%),
			linear-gradient(120deg, rgba(2,6,23,0.03), rgba(2,6,23,0.06)); }
		html[data-bg="image"] body::before { content:""; position:fixed; inset:0; z-index:-2; background:url('https://images.unsplash.com/photo-1527689368864-3a821dbccc34?auto=format&fit=crop&w=2100&q=60') center/cover no-repeat fixed; filter:saturate(1.05) brightness(0.95); }
		body::after { content:""; position:fixed; inset:0; pointer-events:none; z-index:-1; background-image:var(--noise); }

		.glass { background: var(--card-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid var(--card-border); }
		.dark .glass { background: rgba(15,23,42,0.60); border-color: rgba(255,255,255,0.08); }
		.gradient-accent { background-image: linear-gradient(135deg, var(--accent), var(--accent-to)); }
		.text-accent { color: var(--accent); }
		.neon-divider { height:1px; background: linear-gradient(90deg, transparent, var(--accent), transparent); opacity:.6; }
		.fancy-scroll::-webkit-scrollbar { height:10px; width:10px; }
		.fancy-scroll::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--accent), var(--accent-to)); border-radius:9999px; }
		.fancy-scroll::-webkit-scrollbar-track { background: transparent; }
		.big-scroll { scrollbar-width:auto; scrollbar-color: var(--accent) transparent; }
		.big-scroll::-webkit-scrollbar { width:16px; height:16px; }
		.big-scroll::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--accent), var(--accent-to)); border-radius:12px; border:3px solid transparent; background-clip: content-box; }
		.ripple { position: relative; overflow: hidden; }
		.ripple::after { content:''; position:absolute; inset:0; background: radial-gradient(circle, rgba(255,255,255,0.3) 1%, transparent 1%) center/15000%; opacity:0; transition: opacity .5s; }
		.ripple:active::after { opacity:1; background-size:100%; transition:0s; }
		:root { --sidebar: 18rem; }
		@media (min-width: 1024px){ aside[data-resizable]{ width: var(--sidebar) !important; } main[data-shift]{ margin-left: var(--sidebar) !important; } }
		#toastHost { position: fixed; top: 16px; right: 16px; display: grid; gap: 10px; z-index: 80; pointer-events: none; }
		.toast { pointer-events: auto; min-width: 220px; max-width: 360px; padding: 10px 12px; border-radius: 12px; box-shadow: 0 10px 20px rgba(2,6,23,.2); border: 1px solid rgba(255,255,255,.35); }
		.toast.info { background: var(--card-bg); }
		.toast.success { background: linear-gradient(135deg, rgba(16,185,129,.15), rgba(20,184,166,.25)); }
		.toast.warn { background: linear-gradient(135deg, rgba(245,158,11,.15), rgba(245,158,11,.28)); }
		.toast.error { background: linear-gradient(135deg, rgba(244,63,94,.15), rgba(244,63,94,.28)); }
		#topProgress { background-image: linear-gradient(90deg, var(--accent), var(--accent-to)); }
		select, input, textarea { color: #111827; }
		.dark select, .dark input, .dark textarea { background-color: rgba(255,255,255,0.08); color: #e5e7eb; border-color: rgba(255,255,255,0.15); }
		.dark select option { background-color: #0f172a; color: #e5e7eb; }
	</style>
{% endblock %}

{% block content %}
<!-- Hero -->
			<header id="section-top" class="relative overflow-hidden rounded-3xl glass p-6 md:p-8 shadow-glow">
				<div class="absolute inset-0 opacity-40 animate-shine" style="background-image: linear-gradient(90deg, var(--accent), rgba(255,255,255,0.2), var(--accent)); background-size: 200% 100%;"></div>
				<div class="relative z-10 flex items-center justify-between gap-4">
					<div>
						<h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">Leave & Absences ‚Äî Manager Console</h2>
						<p class="mt-1 text-sm md:text-base text-gray-600 dark:text-gray-300">Approve policies and requests, plan blackout periods, and keep balance in check.</p>
					</div>
					<div class="flex items-center gap-3">
						<button id="btnAiAssistant" class="px-4 py-2 rounded-xl text-white bg-gradient-to-r from-emerald-600 to-teal-600 hover:shadow-glow transition flex items-center justify-center gap-2 ripple"><iconify-icon icon="ph:robot-duotone"></iconify-icon> AI Assistant</button>
						<button id="btnNotify" class="px-3 py-2 rounded-xl bg-white/80 dark:bg-slate-900/50 border border-white/40 dark:border-white/10 hover:shadow-glow transition flex items-center justify-center gap-2 ripple"><iconify-icon icon="ph:bell-duotone" class="text-accent"></iconify-icon> Alerts</button>
					</div>
				</div>
			</header>

			<!-- Stats Cards -->
			<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
				<div class="glass rounded-2xl p-5 shadow hover:shadow-glow transition">
					<div class="flex justify-between items-start">
						<div>
							<div class="text-xs text-slate-500">Pending Approvals</div>
							<div class="text-2xl font-extrabold mt-1">18</div>
							<div class="text-xs text-amber-600 mt-2 flex items-center gap-1">‚è≥ Requires attention</div>
						</div>
						<div class="w-10 h-10 rounded-xl bg-amber-500/90 text-white flex items-center justify-center">‚è±</div>
					</div>
				</div>
				<div class="glass rounded-2xl p-5 shadow hover:shadow-glow transition">
					<div class="flex justify-between items-start">
						<div>
							<div class="text-xs text-slate-500">On Leave Today</div>
							<div class="text-2xl font-extrabold mt-1">24</div>
							<div class="text-xs text-blue-600 mt-2 flex items-center gap-1">üìÖ 4.2% of workforce</div>
						</div>
						<div class="w-10 h-10 rounded-xl bg-blue-600/90 text-white flex items-center justify-center">üèù</div>
					</div>
				</div>
				<div class="glass rounded-2xl p-5 shadow hover:shadow-glow transition">
					<div class="flex justify-between items-start">
						<div>
							<div class="text-xs text-slate-500">Policy Violations</div>
							<div class="text-2xl font-extrabold mt-1">3</div>
							<div class="text-xs text-rose-600 mt-2 flex items-center gap-1">‚ö† Needs review</div>
						</div>
						<div class="w-10 h-10 rounded-xl bg-rose-600/90 text-white flex items-center justify-center">üö´</div>
					</div>
				</div>
				<div class="glass rounded-2xl p-5 shadow hover:shadow-glow transition">
					<div class="flex justify-between items-start">
						<div>
							<div class="text-xs text-slate-500">Upcoming Expirations</div>
							<div class="text-2xl font-extrabold mt-1">42</div>
							<div class="text-xs text-purple-600 mt-2 flex items-center gap-1">‚è≥ Within 30 days</div>
						</div>
						<div class="w-10 h-10 rounded-xl bg-purple-600/90 text-white flex items-center justify-center">‚åõ</div>
					</div>
				</div>
			</section>

			<!-- Tabs + Action Bar -->
			<section class="glass rounded-2xl shadow overflow-hidden">
				<div class="border-b border-white/40 dark:border-white/10">
					<nav class="flex overflow-x-auto -mb-px">
						<button data-tab="requests" class="tab-btn py-4 px-6 border-b-2 border-accent text-accent font-medium flex items-center whitespace-nowrap"> <iconify-icon icon="ph:inbox-duotone" class="mr-2"></iconify-icon> Leave Requests </button>
						<button data-tab="calendar" class="tab-btn py-4 px-6 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium flex items-center whitespace-nowrap"> <iconify-icon icon="ph:calendar-duotone" class="mr-2"></iconify-icon> Leave Calendar </button>
						<button data-tab="policies" class="tab-btn py-4 px-6 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium flex items-center whitespace-nowrap"> <iconify-icon icon="ph:gear-six-duotone" class="mr-2"></iconify-icon> Policy Builder </button>
						<button data-tab="analytics" class="tab-btn py-4 px-6 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium flex items-center whitespace-nowrap"> <iconify-icon icon="ph:chart-pie-duotone" class="mr-2"></iconify-icon> Analytics </button>
						<button data-tab="docs" class="tab-btn py-4 px-6 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium flex items-center whitespace-nowrap"> <iconify-icon icon="ph:file-text-duotone" class="mr-2"></iconify-icon> Documentation </button>
					</nav>
				</div>

				<div class="p-6">
					<!-- REQUESTS TAB -->
					<div id="tab-requests" class="tab-pane block">
						<!-- Action Bar -->
						<div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
							<div>
								<h3 class="text-xl font-bold">Pending Leave Requests</h3>
								<p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Review, approve or decline employee leave requests</p>
							</div>
							<div class="flex flex-wrap gap-3">
								<button id="btnCreatePolicy" class="px-4 py-2 rounded-lg text-white bg-gradient-to-r from-emerald-600 to-teal-600 hover:shadow-glow transition flex items-center gap-2 ripple"><iconify-icon icon="ph:plus-duotone"></iconify-icon> Create Policy</button>
								<button id="btnExport" class="px-4 py-2 rounded-lg bg-white/80 dark:bg-slate-900/50 border border-white/40 dark:border-white/10 hover:shadow-glow transition flex items-center gap-2 ripple"><iconify-icon icon="ph:arrow-square-out-duotone"></iconify-icon> Export</button>
								<button id="btnBulkImport" class="px-4 py-2 rounded-lg bg-white/80 dark:bg-slate-900/50 border border-white/40 dark:border-white/10 hover:shadow-glow transition flex items-center gap-2 ripple"><iconify-icon icon="ph:upload-duotone"></iconify-icon> Bulk Import</button>
								<button id="btnAiCheck" class="px-4 py-2 rounded-lg bg-white/80 dark:bg-slate-900/50 border border-white/40 dark:border-white/10 hover:shadow-glow transition flex items-center gap-2 ripple"><iconify-icon icon="ph:robot-duotone"></iconify-icon> AI Check</button>
							</div>
						</div>

						<!-- Leave Requests Table -->
						<div class="glass rounded-xl border border-white/40 dark:border-white/10 overflow-hidden mb-6">
							<div class="overflow-x-auto">
								<table class="min-w-full divide-y divide-white/40 dark:divide-white/10">
									<thead class="bg-white/60 dark:bg-slate-800/60">
										<tr>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Employee</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Leave Type</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Dates</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Duration</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Status</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Approval Stage</th>
											<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
										</tr>
									</thead>
									<tbody class="divide-y divide-white/40 dark:divide-white/10">
										<!-- Row 1 (Michael Chen) -->
										<tr class="hover:bg-white/40 dark:hover:bg-white/5 transition-colors">
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex items-center">
													<img class="h-10 w-10 rounded-full object-cover border-2 border-blue-500" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Employee" />
													<div class="ml-4">
														<div class="text-sm font-medium">Michael Chen</div>
														<div class="text-xs text-gray-500 dark:text-gray-400">Engineering</div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Vacation</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="text-sm">Dec 15 - Dec 22, 2023</div>
												<div class="text-xs text-gray-500">8 days</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm">8 days</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200">Pending</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex -space-x-2">
													<div class="relative">
														<img class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 object-cover" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Approver" />
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-emerald-500 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
													<div class="relative">
														<img class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 object-cover" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Approver" />
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-amber-500 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
													<div class="relative">
														<div class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
															<span class="text-xs font-medium text-gray-600 dark:text-gray-300">+1</span>
														</div>
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-gray-400 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
												<div class="flex gap-2 flex-wrap">
													<button class="text-emerald-600 hover:text-emerald-800 bg-emerald-50 dark:bg-emerald-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:check-fat" class="mr-1"></iconify-icon>Approve</button>
													<button class="text-rose-600 hover:text-rose-800 bg-rose-50 dark:bg-rose-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:x" class="mr-1"></iconify-icon>Deny</button>
													<button class="text-blue-600 hover:text-blue-800 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:eye" class="mr-1"></iconify-icon>View</button>
												</div>
											</td>
										</tr>

										<!-- Row 2 (Emma Roberts) -->
										<tr class="hover:bg-white/40 dark:hover:bg-white/5 transition-colors">
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex items-center">
													<img class="h-10 w-10 rounded-full object-cover border-2 border-purple-500" src="https://randomuser.me/api/portraits/women/68.jpg" alt="Employee" />
													<div class="ml-4">
														<div class="text-sm font-medium">Emma Roberts</div>
														<div class="text-xs text-gray-500 dark:text-gray-400">Marketing</div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 py-1 text-xs rounded-full bg-rose-100 text-rose-800 dark:bg-rose-900 dark:text-rose-200">Sick Leave</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="text-sm">Dec 5 - Dec 7, 2023</div>
												<div class="text-xs text-gray-500">3 days</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm">3 days</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200">Approved</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex -space-x-2">
													<div class="relative">
														<img class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 object-cover" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Approver" />
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-emerald-500 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
													<div class="relative">
														<img class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 object-cover" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Approver" />
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-emerald-500 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
												<div class="flex gap-2 flex-wrap">
													<button class="text-blue-600 hover:text-blue-800 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:eye" class="mr-1"></iconify-icon>View</button>
													<button class="text-purple-600 hover:text-purple-800 bg-purple-50 dark:bg-purple-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:file-text" class="mr-1"></iconify-icon>Docs</button>
												</div>
											</td>
										</tr>

										<!-- Row 3 (David Wilson) -->
										<tr class="hover:bg-white/40 dark:hover:bg-white/5 transition-colors">
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex items-center">
													<img class="h-10 w-10 rounded-full object-cover border-2 border-yellow-500" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Employee" />
													<div class="ml-4">
														<div class="text-sm font-medium">David Wilson</div>
														<div class="text-xs text-gray-500 dark:text-gray-400">Sales</div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">Emergency</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="text-sm">Dec 10 - Dec 10, 2023</div>
												<div class="text-xs text-gray-500">1 day</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm">1 day</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200">Pending</span>
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												<div class="flex -space-x-2">
													<div class="relative">
														<img class="h-8 w-8 rounded-full border-2 border-white dark:border-slate-900 object-cover" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Approver" />
														<div class="absolute bottom-0 right-0 h-3 w-3 bg-amber-500 rounded-full border-2 border-white dark:border-slate-900"></div>
													</div>
												</div>
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
												<div class="flex gap-2 flex-wrap">
													<button class="text-emerald-600 hover:text-emerald-800 bg-emerald-50 dark:bg-emerald-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:check-fat" class="mr-1"></iconify-icon>Approve</button>
													<button class="text-rose-600 hover:text-rose-800 bg-rose-50 dark:bg-rose-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:x" class="mr-1"></iconify-icon>Deny</button>
													<button class="text-blue-600 hover:text-blue-800 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-lg"><iconify-icon icon="ph:eye" class="mr-1"></iconify-icon>View</button>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<!-- Leave Balance + Blackout -->
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-2">
							<div class="glass rounded-xl p-6 border border-white/40 dark:border-white/10">
								<h3 class="text-lg font-semibold mb-4">Leave Balance Overview</h3>
								<div class="space-y-4">
									<div>
										<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Vacation Days</span><span class="font-medium">12.5 / 20 days</span></div>
										<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"><div class="bg-blue-500 h-3 rounded-full" style="width: 62.5%"></div></div>
									</div>
									<div>
										<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Sick Leave</span><span class="font-medium">3 / 10 days</span></div>
										<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"><div class="bg-rose-500 h-3 rounded-full" style="width: 30%"></div></div>
									</div>
									<div>
										<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Personal Days</span><span class="font-medium">5 / 5 days</span></div>
										<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"><div class="bg-purple-500 h-3 rounded-full" style="width: 100%"></div></div>
									</div>
								</div>
							</div>
							<div class="glass rounded-xl p-6 border border-white/40 dark:border-white/10">
								<h3 class="text-lg font-semibold mb-4">Upcoming Blackout Periods</h3>
								<div class="space-y-3">
									<div class="flex items-center justify-between p-3 bg-rose-50 dark:bg-rose-900/30 rounded-lg">
										<div>
											<p class="font-medium">Year-End Closing</p>
											<p class="text-xs text-gray-500 dark:text-gray-400">Dec 25 - Jan 2</p>
										</div>
										<span class="px-2 py-1 bg-rose-100 dark:bg-rose-800 text-rose-800 dark:text-rose-200 text-xs rounded-full">No Leave</span>
									</div>
									<div class="flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/30 rounded-lg">
										<div>
											<p class="font-medium">Audit Period</p>
											<p class="text-xs text-gray-500 dark:text-gray-400">Jan 15 - Jan 30</p>
										</div>
										<span class="px-2 py-1 bg-amber-100 dark:bg-amber-800 text-amber-800 dark:text-amber-200 text-xs rounded-full">Restricted</span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- CALENDAR TAB -->
								<div id="tab-calendar" class="tab-pane hidden">
									<div class="flex items-center justify-between mb-4">
										<h3 class="text-lg font-semibold">Team Leave Calendar ‚Äî <span id="leaveCalMonthLabel">Month</span></h3>
										<div class="flex gap-2">
											<button id="btnLeaveCalPrev" class="px-3 py-2 rounded-lg glass">Prev</button>
											<button id="btnLeaveCalToday" class="px-3 py-2 rounded-lg glass">Today</button>
											<button id="btnLeaveCalNext" class="px-3 py-2 rounded-lg glass">Next</button>
										</div>
									</div>
									<div class="glass rounded-xl border border-white/40 dark:border-white/10 overflow-hidden">
										<div class="grid grid-cols-7 text-center text-xs font-medium bg-white/50 dark:bg-slate-800/50">
											<div class="p-2">Mon</div><div class="p-2">Tue</div><div class="p-2">Wed</div><div class="p-2">Thu</div><div class="p-2">Fri</div><div class="p-2">Sat</div><div class="p-2">Sun</div>
										</div>
										<div id="leaveCalendarGrid" class="grid grid-cols-7 gap-0 divide-x divide-y divide-white/40 dark:divide-white/10"></div>
									</div>
									<div class="text-xs text-gray-500 dark:text-gray-400 mt-2">Demo calendar. Hook into your data-source to populate real events.</div>
								</div>

					<!-- POLICY BUILDER TAB -->
					<div id="tab-policies" class="tab-pane hidden">
						<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
							<div class="glass rounded-xl p-4 border border-white/40 dark:border-white/10">
								<h3 class="font-semibold mb-3 flex items-center gap-2"><iconify-icon icon="ph:sliders-duotone" class="text-accent"></iconify-icon> Create Policy</h3>
								<form id="policyForm" class="space-y-3">
									<div>
										<label class="text-xs text-gray-500">Name</label>
										<input id="polName" type="text" required class="mt-1 w-full px-3 py-2 rounded-lg border border-white/40 dark:border-white/10 glass" placeholder="e.g., Vacation Policy" />
									</div>
									<div class="grid grid-cols-2 gap-3">
										<div>
											<label class="text-xs text-gray-500">Accrual rate (days/year)</label>
											<input id="polAccrual" type="number" step="0.5" min="0" class="mt-1 w-full px-3 py-2 rounded-lg border border-white/40 dark:border-white/10 glass" value="20" />
										</div>
										<div>
											<label class="text-xs text-gray-500">Carryover limit (days)</label>
											<input id="polCarry" type="number" step="0.5" min="0" class="mt-1 w-full px-3 py-2 rounded-lg border border-white/40 dark:border-white/10 glass" value="5" />
										</div>
									</div>
									<div>
										<label class="text-xs text-gray-500">Eligible roles (comma separated)</label>
										<input id="polRoles" type="text" class="mt-1 w-full px-3 py-2 rounded-lg border border-white/40 dark:border-white/10 glass" placeholder="Full-time, Part-time" />
									</div>
									<label class="flex items-center gap-2 text-sm"><input id="polRequiresDocs" type="checkbox" class="w-4 h-4" /> Require medical documents for Sick Leave</label>
									<div class="flex gap-2 justify-end">
										<button type="reset" class="px-3 py-2 rounded-lg glass">Clear</button>
										<button type="submit" class="px-3 py-2 rounded-lg text-white gradient-accent">Save Policy</button>
									</div>
								</form>
							</div>
							<div class="lg:col-span-2 glass rounded-xl p-4 border border-white/40 dark:border-white/10">
								<div class="flex items-center justify-between mb-3">
									<h3 class="font-semibold">Saved Policies</h3>
									<div class="flex gap-2">
										<button id="polExport" class="px-3 py-2 rounded-lg glass text-sm">Export JSON</button>
										<button id="polImportBtn" class="px-3 py-2 rounded-lg glass text-sm">Import JSON</button>
										<input id="polFile" type="file" accept="application/json" class="hidden" />
										<button id="polClearAll" class="px-3 py-2 rounded-lg glass text-sm">Clear All</button>
									</div>
								</div>
								<div id="polList" class="grid gap-3"></div>
								<div id="polEmpty" class="text-sm text-gray-500 dark:text-gray-400">No policies yet. Create one on the left.</div>
							</div>
						</div>
					</div>

					<!-- ANALYTICS TAB -->
					<div id="tab-analytics" class="tab-pane hidden">
						<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
							<div class="glass rounded-xl p-4 border border-white/40 dark:border-white/10">
								<div class="flex items-center justify-between mb-2">
									<h3 class="font-semibold">Leave Type Distribution</h3>
									<button id="anaRecompute" class="px-3 py-2 rounded-lg glass text-sm">Recompute</button>
								</div>
								<canvas id="chartLeaveTypes" height="180"></canvas>
							</div>
							<div class="glass rounded-xl p-4 border border-white/40 dark:border-white/10">
								<h3 class="font-semibold mb-2">Monthly Leave Trend</h3>
								<canvas id="chartLeaveTrend" height="180"></canvas>
							</div>
						</div>
					</div>

					<!-- DOCUMENTATION TAB -->
					<div id="tab-docs" class="tab-pane hidden">
						<div class="glass rounded-xl p-6 border border-white/40 dark:border-white/10">
							<div class="flex items-center gap-3 mb-3">
								<iconify-icon icon="ph:file-text-duotone" class="text-accent text-2xl"></iconify-icon>
								<h3 class="text-lg font-semibold">Documentation</h3>
							</div>
							<ul class="list-disc pl-6 space-y-2 text-sm text-gray-700 dark:text-gray-300">
								<li>Leave Requests: multi-level approval, attachments, audit trail.</li>
								<li>Calendar: blackout periods, public holidays, team overlays.</li>
								<li>Policies: eligibility, accrual, carryover rules, violations.</li>
								<li>Analytics: utilization, trends, seasonal peaks, anomalies.</li>
							</ul>
							<div class="mt-4 flex gap-2">
								<button id="docDownload" class="px-3 py-2 rounded-lg glass">Download PDF</button>
								<button id="docOpen" class="px-3 py-2 rounded-lg text-white gradient-accent">Open Guide</button>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Feature Highlights -->
			<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
				<div class="rounded-2xl shadow-xl p-6 text-white gradient-accent hover:shadow-glow transition">
					<div class="flex items-center justify-between mb-4">
						<h3 class="text-lg font-semibold">Policy Builder</h3>
						<iconify-icon icon="ph:sliders-duotone" class="text-2xl"></iconify-icon>
					</div>
					<p class="text-white/90 mb-4">Create and manage comprehensive leave policies with configurable rules, eligibility, and accrual settings.</p>
					<button class="text-sm bg-white text-teal-600 hover:bg-teal-50 px-3 py-2 rounded-lg font-medium flex items-center gap-2 ripple"><iconify-icon icon="ph:wrench"></iconify-icon> Configure Policies</button>
				</div>
				<div class="rounded-2xl shadow-xl p-6 text-white" style="background-image: linear-gradient(135deg,#3b82f6,#1d4ed8)">
					<div class="flex items-center justify-between mb-4">
						<h3 class="text-lg font-semibold">Multi-level Approval</h3>
						<iconify-icon icon="ph:tree-structure-duotone" class="text-2xl"></iconify-icon>
					</div>
					<p class="text-white/90 mb-4">Set up complex approval workflows with conditional routing, delegation, and auto-escalation.</p>
					<button class="text-sm bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg font-medium flex items-center gap-2 ripple"><iconify-icon icon="ph:projector-screen-chart"></iconify-icon> Manage Workflows</button>
				</div>
				<div class="rounded-2xl shadow-xl p-6 text-white" style="background-image: linear-gradient(135deg,#a855f7,#7c3aed)">
					<div class="flex items-center justify-between mb-4">
						<h3 class="text-lg font-semibold">Leave Analytics</h3>
						<iconify-icon icon="ph:chart-bar-duotone" class="text-2xl"></iconify-icon>
					</div>
					<p class="text-white/90 mb-4">Gain insights into leave trends, utilization patterns, and seasonal peaks with visual analytics.</p>
					<button class="text-sm bg-white text-purple-600 hover:bg-purple-50 px-3 py-2 rounded-lg font-medium flex items-center gap-2 ripple"><iconify-icon icon="ph:chart-line-up"></iconify-icon> View Reports</button>
				</div>
			</section>

			<!-- Bottom Stats -->
			<section class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div class="glass rounded-2xl p-6 border border-white/40 dark:border-white/10">
					<div class="flex items-center justify-between mb-4">
						<h3 class="font-semibold">Leave Type Distribution</h3>
						<iconify-icon icon="ph:chart-pie-duotone" class="text-accent"></iconify-icon>
					</div>
					<div class="space-y-4">
						<div>
							<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Vacation</span><span class="font-medium">45%</span></div>
							<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div></div>
						</div>
						<div>
							<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Sick Leave</span><span class="font-medium">30%</span></div>
							<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-rose-500 h-2 rounded-full" style="width: 30%"></div></div>
						</div>
						<div>
							<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Personal</span><span class="font-medium">15%</span></div>
							<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-purple-500 h-2 rounded-full" style="width: 15%"></div></div>
						</div>
						<div>
							<div class="flex justify-between text-sm mb-1"><span class="text-gray-600 dark:text-gray-400">Emergency</span><span class="font-medium">10%</span></div>
							<div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-amber-500 h-2 rounded-full" style="width: 10%"></div></div>
						</div>
					</div>
				</div>
				<div class="glass rounded-2xl p-6 border border-white/40 dark:border-white/10">
					<div class="flex items-center justify-between mb-4">
						<h3 class="font-semibold">Recent Activities</h3>
						<iconify-icon icon="ph:clock-counter-clockwise-duotone" class="text-purple-500"></iconify-icon>
					</div>
					<div class="space-y-3">
						<div class="flex items-start"><div class="p-2 bg-emerald-100 dark:bg-emerald-900 rounded-lg mr-3">‚úî</div><div><p class="text-sm font-medium">Leave approved for Sarah Johnson</p><p class="text-xs text-gray-500 dark:text-gray-400">Today, 11:30 AM</p></div></div>
						<div class="flex items-start"><div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg mr-3">Ôºã</div><div><p class="text-sm font-medium">New leave policy created</p><p class="text-xs text-gray-500 dark:text-gray-400">Today, 9:15 AM</p></div></div>
						<div class="flex items-start"><div class="p-2 bg-amber-100 dark:bg-amber-900 rounded-lg mr-3">!</div><div><p class="text-sm font-medium">Policy violation detected</p><p class="text-xs text-gray-500 dark:text-gray-400">Yesterday, 4:45 PM</p></div></div>
					</div>
				</div>
			</section>

			<footer class="pb-8 pt-2 text-xs text-gray-500 dark:text-gray-400 text-center">¬© IntelliHRTrack ‚Ä¢ Module 5 ‚Äî Demonstration build. Leave interactions are simulated.</footer>
{% endblock %}

{% block extra_js %}
<script>
		// ---------- THEME ----------
		const themeToggle = document.getElementById('themeToggle');
		function setThemeMode(mode){
			if(mode==='dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark');
			localStorage.setItem('ih_theme', mode);
			localStorage.setItem('iht_theme_v1', mode);
		}
		const savedTheme = localStorage.getItem('ih_theme') || localStorage.getItem('iht_theme_v1') || 'light';
		setThemeMode(savedTheme);
		themeToggle?.addEventListener('click', ()=> setThemeMode(document.documentElement.classList.contains('dark') ? 'light' : 'dark'));

		// ---------- TOASTS ----------
		const toastHost = document.getElementById('toastHost');
		function showToast(msg, type='info', duration=2200){
			const t = document.createElement('div');
			t.className = `toast ${type}`;
			t.innerHTML = `<div class="text-sm">${msg}</div>`;
			toastHost.appendChild(t);
			setTimeout(()=>{ t.style.opacity = '0'; t.style.transform = 'translateY(-6px)'; setTimeout(()=> t.remove(), 300); }, duration);
		}

		// ---------- TOP PROGRESS ----------
		const topProgress = document.getElementById('topProgress');
		function progressStart(){ topProgress.style.transition='none'; topProgress.style.width='0'; topProgress.style.opacity='1'; requestAnimationFrame(()=>{ topProgress.style.transition='width .8s ease'; topProgress.style.width='75%'; }); }
		function progressDone(){ topProgress.style.width='100%'; setTimeout(()=>{ topProgress.style.opacity='0'; topProgress.style.width='0'; }, 350); }

		// Hook buttons for feedback
		const hooks = [
			['btnCreatePolicy','Creating policy‚Ä¶','success',900],
			['btnExport','Exporting‚Ä¶','info',800],
			['btnBulkImport','Opening importer‚Ä¶','info',800],
			['btnAiCheck','Running AI checks‚Ä¶','success',1200],
			['btnAiAssistant','Launching assistant‚Ä¶','info',700],
			['btnNotify','Checking notifications‚Ä¶','info',600],
			['docDownload','Preparing PDF‚Ä¶','info',700],
			['docOpen','Opening guide‚Ä¶','info',700]
		];
		hooks.forEach(([id,msg,type,dur])=>{ const el=document.getElementById(id); if(!el) return; el.addEventListener('click', ()=>{ progressStart(); showToast(msg,type); setTimeout(progressDone, dur); }); });

		// ---------- BACK TO TOP ----------
		const backToTop = document.getElementById('backToTop');
		window.addEventListener('scroll', ()=>{ if(window.scrollY > 400) backToTop.classList.remove('hidden'); else backToTop.classList.add('hidden'); });
		backToTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

		// ---------- NAV SMOOTH SCROLL (desktop + mobile) ----------
		const asideLinks = Array.from(document.querySelectorAll('aside a[data-target]'));
		function wireSmooth(list){
			list.forEach(a=> a.addEventListener('click', (e)=>{
				e.preventDefault(); const sel = a.getAttribute('data-target'); const el = document.querySelector(sel);
				if(el){ window.scrollTo({ top: el.getBoundingClientRect().top + window.scrollY - 12, behavior:'smooth'}); closeMobile(); }
				list.forEach(n=> n.classList.remove('ring','ring-white/30'));
				a.classList.add('ring','ring-white/30');
			}));
		}
		wireSmooth(asideLinks);

		// ---------- MOBILE SIDEBAR ----------
		const mobileSidebar = document.getElementById('mobileSidebar');
		const mobilePanel = document.getElementById('mobilePanel');
		const mobileBackdrop = document.getElementById('mobileBackdrop');
		const closeMobileBtn = document.getElementById('closeMobile');
		const mobileFab = document.getElementById('mobileMenuFab');
		function openMobile(){
			const desk = document.querySelector('aside nav ul');
			const mobileNavContent = document.getElementById('mobileNavContent');
			if(desk && mobileNavContent){ mobileNavContent.innerHTML=''; mobileNavContent.appendChild(desk.cloneNode(true));
				mobileNavContent.querySelectorAll('a').forEach(a=>{
					a.addEventListener('click', (ev)=>{
						const tgt = a.getAttribute('data-target');
						if(tgt){ ev.preventDefault(); const el = document.querySelector(tgt); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); } mobileNavContent.querySelectorAll('a').forEach(n=> n.classList.remove('ring','ring-white/30')); a.classList.add('ring','ring-white/30'); }
						closeMobile();
					});
				});
			}
			mobileSidebar.classList.remove('hidden');
			setTimeout(()=> mobilePanel.classList.remove('-translate-x-full'), 10);
		}
		function closeMobile(){ mobilePanel.classList.add('-translate-x-full'); setTimeout(()=> mobileSidebar.classList.add('hidden'), 250); }
		mobileFab?.addEventListener('click', openMobile);
		mobileBackdrop?.addEventListener('click', closeMobile);
		closeMobileBtn?.addEventListener('click', closeMobile);

		// ---------- SETTINGS & SHORTCUTS ----------
		const settingsPanel = document.getElementById('settingsPanel');
		const closeSettings = document.getElementById('closeSettings');
		function openSettings(){ settingsPanel.classList.remove('hidden'); settingsPanel.classList.add('flex'); }
		function closeSettingsFn(){ settingsPanel.classList.add('hidden'); settingsPanel.classList.remove('flex'); }
		document.getElementById('customizeLayout')?.addEventListener('click', openSettings);
		closeSettings?.addEventListener('click', closeSettingsFn);
		settingsPanel?.addEventListener('click', (e)=>{ if(e.target===settingsPanel) closeSettingsFn(); });

		const shortcutsModal = document.getElementById('shortcutsModal');
		const closeShortcuts = document.getElementById('closeShortcuts');
		function openShortcuts(){ shortcutsModal.classList.remove('hidden'); shortcutsModal.classList.add('flex'); }
		function closeShortcutsFn(){ shortcutsModal.classList.add('hidden'); shortcutsModal.classList.remove('flex'); }
		document.getElementById('shortcutsBtn')?.addEventListener('click', openShortcuts);
		closeShortcuts?.addEventListener('click', closeShortcutsFn);
		shortcutsModal?.addEventListener('click', (e)=>{ if(e.target===shortcutsModal) closeShortcutsFn(); });

		const accentBtns = Array.from(document.querySelectorAll('#settingsPanel [data-accent]'));
		const bgBtns = Array.from(document.querySelectorAll('#settingsPanel [data-bg]'));
		const densityBtns = Array.from(document.querySelectorAll('#settingsPanel [data-density]'));
		const glassIntensity = document.getElementById('glassIntensity');
		const motionToggle = document.getElementById('motionToggle');
		const contrastToggle = document.getElementById('contrastToggle');
		const sidebarBtns = Array.from(document.querySelectorAll('#settingsPanel [data-sidebar]'));
		const fontBtns = Array.from(document.querySelectorAll('#settingsPanel [data-font]'));
		const saveSettings = document.getElementById('saveSettings');
		const resetSettings = document.getElementById('resetSettings');
		const exportPrefs = document.getElementById('exportPrefs');
		const importPrefsBtn = document.getElementById('importPrefsBtn');
		const prefsFile = document.getElementById('prefsFile');

		function getPrefs(){ try{ return JSON.parse(localStorage.getItem('ih_prefs')) || {}; }catch{ return {}; } }
		function setPrefs(p){ localStorage.setItem('ih_prefs', JSON.stringify(p)); }
		function applyPrefs(p){ if(p.accent) document.documentElement.setAttribute('data-accent', p.accent); if(p.bg) document.documentElement.setAttribute('data-bg', p.bg); document.documentElement.setAttribute('data-density', p.density||'comfortable'); document.documentElement.classList.toggle('reduce-motion', !!p.reduceMotion); if(motionToggle) motionToggle.checked = !!p.reduceMotion; }
		function applyGlass(val){ const alpha = parseFloat(val||'0.6'); document.documentElement.style.setProperty('--card-bg', `rgba(255,255,255,${alpha})`); document.documentElement.style.setProperty('--card-border', `rgba(255,255,255,${Math.max(0, Math.min(1, alpha*0.6))})`); }
		function applySidebar(size){ const map = { narrow:'14rem', default:'18rem', wide:'22rem' }; const px = map[size] || map.default; document.documentElement.style.setProperty('--sidebar', px); }
		function applyFont(f){ const size = f==='small'? '0.95rem' : f==='large'? '1.05rem' : '1rem'; document.documentElement.setAttribute('data-font', f||'base'); document.body.style.fontSize = size; }
		function applyPrefsExtended(p){ if(p.glass) applyGlass(p.glass); if(p.sidebar) applySidebar(p.sidebar); if(p.contrast!==undefined) document.documentElement.classList.toggle('high-contrast', !!p.contrast); if(p.font) applyFont(p.font); if(glassIntensity) glassIntensity.value = p.glass || '0.6'; if(contrastToggle) contrastToggle.checked = !!p.contrast; }
		const initPrefs = getPrefs(); applyPrefs(initPrefs); applyPrefsExtended(initPrefs);
		accentBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-accent', b.dataset.accent)));
		bgBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-bg', b.dataset.bg)));
		densityBtns.forEach(b=> b.addEventListener('click', ()=> document.documentElement.setAttribute('data-density', b.dataset.density)));
		sidebarBtns.forEach(b=> b.addEventListener('click', ()=> applySidebar(b.dataset.sidebar)));
		fontBtns.forEach(b=> b.addEventListener('click', ()=> applyFont(b.dataset.font)));
		glassIntensity?.addEventListener('input', ()=> applyGlass(glassIntensity.value));
		contrastToggle?.addEventListener('change', ()=> document.documentElement.classList.toggle('high-contrast', contrastToggle.checked));
		saveSettings?.addEventListener('click', ()=>{ const prev = getPrefs(); const p = { accent: document.documentElement.getAttribute('data-accent'), bg: document.documentElement.getAttribute('data-bg'), density: document.documentElement.getAttribute('data-density'), reduceMotion: motionToggle?.checked, glass: glassIntensity ? glassIntensity.value : (prev.glass||'0.6'), sidebar: prev.sidebar || 'default', contrast: contrastToggle ? contrastToggle.checked : !!prev.contrast, font: document.documentElement.getAttribute('data-font') || prev.font || 'base' }; setPrefs(p); applyPrefs(p); applyPrefsExtended(p); closeSettingsFn(); showToast('Preferences saved','success'); });
		resetSettings?.addEventListener('click', ()=>{ const p = {accent:'teal', bg:'gradient', density:'comfortable', reduceMotion:false, glass:'0.6', sidebar:'default', contrast:false, font:'base'}; setPrefs(p); applyPrefs(p); applyPrefsExtended(p); showToast('Preferences reset','info'); });
		exportPrefs?.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(getPrefs(),null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ih_prefs.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
		importPrefsBtn?.addEventListener('click', ()=> prefsFile && prefsFile.click());
		prefsFile?.addEventListener('change', async ()=>{ const file=prefsFile.files&&prefsFile.files[0]; if(!file) return; try{ const txt=await file.text(); const json=JSON.parse(txt); setPrefs(json); applyPrefs(json); applyPrefsExtended(json); showToast('Preferences imported','success'); }catch{ showToast('Invalid preferences file','error'); } });

		// ---------- SHORTCUTS ----------
		document.addEventListener('keydown', (e)=>{
			if(e.target && ['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) return;
			if(e.key.toLowerCase()==='s'){ e.preventDefault(); openSettings(); }
			if(e.key.toLowerCase()==='t'){ e.preventDefault(); themeToggle?.click(); }
			if(e.key==='?'){ e.preventDefault(); openShortcuts(); }
			if(e.key.toLowerCase()==='n'){ e.preventDefault(); document.getElementById('btnCreatePolicy')?.click(); }
		});

		// ---------- TABS ----------
		const tabBtns = Array.from(document.querySelectorAll('.tab-btn'));
		const panes = {
			requests: document.getElementById('tab-requests'),
			calendar: document.getElementById('tab-calendar'),
			policies: document.getElementById('tab-policies'),
			analytics: document.getElementById('tab-analytics'),
			docs: document.getElementById('tab-docs')
		};
		function activateTab(name){
			Object.entries(panes).forEach(([k,el])=>{ if(!el) return; if(k===name){ el.classList.remove('hidden'); el.classList.add('block'); } else { el.classList.add('hidden'); el.classList.remove('block'); } });
			tabBtns.forEach(b=>{
				if(b.dataset.tab===name){ b.classList.add('text-accent'); b.classList.add('border-accent'); b.classList.remove('border-transparent'); b.classList.remove('text-gray-500','dark:text-gray-400'); }
				else { b.classList.remove('text-accent','border-accent'); b.classList.add('border-transparent'); b.classList.add('text-gray-500'); }
			});
		}
		tabBtns.forEach(b=> b.addEventListener('click', ()=> activateTab(b.dataset.tab)));

			// ---------- Leave Calendar (render via DOM) ----------
			const leaveCalendarGrid = document.getElementById('leaveCalendarGrid');
			const leaveCalMonthLabel = document.getElementById('leaveCalMonthLabel');
			const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
			const lcToday = new Date();
			let lcYear = lcToday.getFullYear();
			let lcMonth = lcToday.getMonth(); // 0-11
			function monthLabel(y,m){ return `${monthNames[m]} ${y}`; }
			function renderLeaveCalendar(){
				if(!leaveCalendarGrid) return;
				leaveCalendarGrid.innerHTML = '';
				if(leaveCalMonthLabel) leaveCalMonthLabel.textContent = monthLabel(lcYear, lcMonth);
				const first = new Date(lcYear, lcMonth, 1);
				const startWeekday = (first.getDay() + 6) % 7; // Monday=0
				const daysInMonth = new Date(lcYear, lcMonth+1, 0).getDate();
				const totalCells = 35; // 5 weeks grid
				for(let i=0;i<totalCells;i++){
					const day = i - startWeekday + 1;
					const inMonth = day>0 && day<=daysInMonth;
					const cell = document.createElement('div');
					cell.className = 'p-2 h-24 align-top ' + (inMonth ? '' : 'opacity-40');
					cell.innerHTML = `<div class="text-[11px]">${inMonth?day:''}</div>`;
					if(inMonth){
						// Demo badges (static examples)
						if(day===5){ const b=document.createElement('span'); b.className='mt-1 px-1.5 py-0.5 text-[10px] rounded inline-block bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-200'; b.textContent='Emma: Sick'; cell.appendChild(b); }
						if(day===16){ const b=document.createElement('span'); b.className='mt-1 px-1.5 py-0.5 text-[10px] rounded inline-block bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200'; b.textContent='Blackout'; cell.appendChild(b); }
						if(day===21){ const b=document.createElement('span'); b.className='mt-1 px-1.5 py-0.5 text-[10px] rounded inline-block bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200'; b.textContent='Michael: Vacation'; cell.appendChild(b); }
					}
					leaveCalendarGrid.appendChild(cell);
				}
			}
			document.getElementById('btnLeaveCalPrev')?.addEventListener('click', ()=>{ lcMonth--; if(lcMonth<0){ lcMonth=11; lcYear--; } renderLeaveCalendar(); });
			document.getElementById('btnLeaveCalToday')?.addEventListener('click', ()=>{ const t=new Date(); lcYear=t.getFullYear(); lcMonth=t.getMonth(); renderLeaveCalendar(); });
			document.getElementById('btnLeaveCalNext')?.addEventListener('click', ()=>{ lcMonth++; if(lcMonth>11){ lcMonth=0; lcYear++; } renderLeaveCalendar(); });

			// Render once on load, and again when tab opened
			renderLeaveCalendar();
			const origActivateTab = activateTab;
			activateTab = function(name){ origActivateTab(name); if(name==='calendar') renderLeaveCalendar(); };

		// ---------- Policy Builder (localStorage) ----------
		const POL_KEY='iht_leave_policies_v1';
		function loadPolicies(){ try{ return JSON.parse(localStorage.getItem(POL_KEY))||[]; }catch{ return []; } }
		function savePolicies(arr){ localStorage.setItem(POL_KEY, JSON.stringify(arr)); }
		function renderPolicies(){ const list=document.getElementById('polList'); const empty=document.getElementById('polEmpty'); if(!list) return; const arr=loadPolicies(); list.innerHTML=''; if(!arr.length){ empty && (empty.style.display='block'); return; } empty && (empty.style.display='none'); arr.forEach((p,i)=>{ const row=document.createElement('div'); row.className='glass rounded-lg p-3 flex items-center justify-between border border-white/40 dark:border-white/10'; row.innerHTML=`<div><div class="font-medium text-sm">${p.name}</div><div class="text-xs text-gray-500">Accrual: ${p.accrual}/yr ‚Ä¢ Carryover: ${p.carry} ‚Ä¢ Roles: ${(p.roles||[]).join(', ')||'‚Äî'} ${p.docs?'‚Ä¢ Docs required':''}</div></div><button data-del="${i}" class="px-2 py-1 rounded-lg glass text-xs">Delete</button>`; list.appendChild(row); }); list.querySelectorAll('[data-del]').forEach(b=> b.addEventListener('click', ()=>{ const arr=loadPolicies(); arr.splice(parseInt(b.getAttribute('data-del')),1); savePolicies(arr); renderPolicies(); })); }
		document.getElementById('policyForm')?.addEventListener('submit', (e)=>{ e.preventDefault(); const name=document.getElementById('polName').value.trim(); if(!name){ showToast('Name required','warn'); return; } const accrual=parseFloat(document.getElementById('polAccrual').value||'0'); const carry=parseFloat(document.getElementById('polCarry').value||'0'); const roles=document.getElementById('polRoles').value.split(',').map(s=>s.trim()).filter(Boolean); const docs=document.getElementById('polRequiresDocs').checked; const arr=loadPolicies(); arr.push({id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),name,accrual,carry,roles,docs}); savePolicies(arr); renderPolicies(); e.target.reset(); showToast('Policy saved','success'); });
		document.getElementById('polExport')?.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(loadPolicies(),null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='leave_policies.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
		const polImportBtn=document.getElementById('polImportBtn'); const polFile=document.getElementById('polFile');
		polImportBtn?.addEventListener('click', ()=> polFile && polFile.click());
		polFile?.addEventListener('change', async ()=>{ const f=polFile.files&&polFile.files[0]; if(!f) return; try{ const txt=await f.text(); const json=JSON.parse(txt); if(Array.isArray(json)){ savePolicies(json); renderPolicies(); showToast('Policies imported','success'); } else { showToast('Invalid policy file','error'); } }catch{ showToast('Import failed','error'); }});
		document.getElementById('polClearAll')?.addEventListener('click', ()=>{ savePolicies([]); renderPolicies(); showToast('Policies cleared','info'); });

		// ---------- Analytics (Chart.js) ----------
		let chartLeaveTypes, chartLeaveTrend;
		function initCharts(){ const c1=document.getElementById('chartLeaveTypes'); const c2=document.getElementById('chartLeaveTrend'); if(!c1||!c2||!window.Chart) return; chartLeaveTypes=new Chart(c1,{ type:'doughnut', data:{ labels:['Vacation','Sick','Personal','Emergency'], datasets:[{ data:[45,30,15,10], backgroundColor:['#3b82f6','#f43f5e','#a855f7','#f59e0b'] }] }, options:{ plugins:{ legend:{ position:'bottom' } } } }); chartLeaveTrend=new Chart(c2,{ type:'line', data:{ labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'], datasets:[{ label:'Leaves', data:[22,18,26,24,30,28,35,32,29,25,27,31], borderColor:'#14b8a6', backgroundColor:'rgba(20,184,166,.2)', tension:.35, fill:true }] }, options:{ scales:{ y:{ beginAtZero:true } } } }); }
		function recomputeAnalytics(){ // Simple recompute based on policies count (demo)
			const count = loadPolicies().length; if(chartLeaveTrend){ const base=[22,18,26,24,30,28,35,32,29,25,27,31]; chartLeaveTrend.data.datasets[0].data = base.map((v,i)=> v + (i%3===0?count:0)); chartLeaveTrend.update(); }
			showToast('Analytics updated','success');
		}
		document.getElementById('anaRecompute')?.addEventListener('click', recomputeAnalytics);

		// Initialize dynamic sections
		renderPolicies(); initCharts();

		// Initial load toast
		setTimeout(()=>{ try{ showToast('Leave & Absences ready','success'); }catch(_){} }, 700);
	</script>
<script>
		// Sidebar active link highlighter (matches current filename)
		(function(){
			try{
				const current = location.pathname.split('/').pop();
				const links = document.querySelectorAll('aside nav a[href]');
				links.forEach(a=>{
					const href = a.getAttribute('href') || '';
					const name = href.split('/').pop();
					if(!name) return;
					if(name === current){
						a.classList.add('ring','ring-white/30','bg-accent/10');
						a.setAttribute('aria-current','page');
					}
				});
			}catch(e){}
		})();
	</script>
{% endblock %}
