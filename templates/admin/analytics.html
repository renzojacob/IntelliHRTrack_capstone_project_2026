{% extends 'admin/base_admin.html' %}

{% block title %}IntelliHRTrack — AI Workforce Analytics{% endblock %}

{% block extra_head %}

{% endblock %}

{% block content %}
<!-- Hero Section -->
      <header class="relative overflow-hidden rounded-3xl glass p-6 md:p-8 shadow-lg">
        <div class="absolute inset-0 opacity-40 animate-shine"></div>
        <div class="relative z-10 flex items-center justify-between gap-4">
          <div>
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">AI Workforce Analytics</h1>
            <p class="mt-1 text-sm md:text-base text-gray-600 dark:text-gray-300">Advanced AI-powered insights into your workforce patterns and productivity</p>
          </div>
          <div class="flex items-center gap-3">
            <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded-xl glass text-xs">
              <span id="netDot" class="inline-block w-2.5 h-2.5 rounded-full bg-green-500" title="Online"></span>
              <span id="headerClock">--:--:--</span>
            </div>
            <button id="themeToggle" class="p-2 rounded-xl glass hover:shadow-lg transition">
              <iconify-icon icon="ph:sun-dim-duotone" class="hidden dark:inline text-accent"></iconify-icon>
              <iconify-icon icon="ph:moon-stars-duotone" class="dark:hidden text-accent"></iconify-icon>
            </button>
          </div>
        </div>
      </header>

      <!-- Key Metrics Overview -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="glass rounded-2xl p-4 shadow transition hover:shadow-lg hover-lift">
          <div class="text-xs text-gray-500 dark:text-gray-400">Workforce Stability Index</div>
          <div class="mt-1 text-3xl font-extrabold">87.4%</div>
          <div class="text-sm text-green-500 flex items-center gap-1">
            <iconify-icon icon="ph:trend-up-duotone"></iconify-icon>
            <span>+2.3% from last month</span>
          </div>
        </div>
        
        <div class="glass rounded-2xl p-4 shadow transition hover:shadow-lg hover-lift">
          <div class="text-xs text-gray-500 dark:text-gray-400">Absenteeism Risk</div>
          <div class="mt-1 text-3xl font-extrabold text-amber-600">12.7%</div>
          <div class="text-sm text-amber-500 flex items-center gap-1">
            <iconify-icon icon="ph:warning-duotone"></iconify-icon>
            <span>3 departments at risk</span>
          </div>
        </div>
        
        <div class="glass rounded-2xl p-4 shadow transition hover:shadow-lg hover-lift">
          <div class="text-xs text-gray-500 dark:text-gray-400">Predictive Turnover</div>
          <div class="mt-1 text-3xl font-extrabold">8.2%</div>
          <div class="text-sm text-red-500 flex items-center gap-1">
            <iconify-icon icon="ph:trend-down-duotone"></iconify-icon>
            <span>+1.5% from last quarter</span>
          </div>
        </div>
        
        <div class="glass rounded-2xl p-4 shadow transition hover:shadow-lg hover-lift">
          <div class="text-xs text-gray-500 dark:text-gray-400">AI Confidence</div>
          <div class="mt-1 text-3xl font-extrabold text-purple-600">96.4%</div>
          <div class="text-sm text-purple-500 flex items-center gap-1">
            <iconify-icon icon="ph:brain-duotone"></iconify-icon>
            <span>High accuracy</span>
          </div>
        </div>
      </div>

      <!-- Main Dashboard Content (features preserved) -->
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <!-- Left Column -->
        <div class="space-y-6">
          <!-- Feature 1: Workforce Analytics Dashboard -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-bold">Workforce Analytics Dashboard</h2>
              <div class="flex items-center gap-2">
                <button class="p-2 rounded-lg glass text-sm">Daily</button>
                <button class="p-2 rounded-lg glass text-sm bg-accent text-white">Weekly</button>
                <button class="p-2 rounded-lg glass text-sm">Monthly</button>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                <p class="text-sm text-gray-600 dark:text-gray-400">Avg. Attendance</p>
                <p class="text-2xl font-bold">94.2%</p>
              </div>
              <div class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl">
                <p class="text-sm text-gray-600 dark:text-gray-400">Productivity</p>
                <p class="text-2xl font-bold">88.7%</p>
              </div>
              <div class="p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl">
                <p class="text-sm text-gray-600 dark:text-gray-400">Overtime Hours</p>
                <p class="text-2xl font-bold">247</p>
              </div>
              <div class="p-4 bg-amber-50 dark:bg-amber-900/30 rounded-xl">
                <p class="text-sm text-gray-600 dark:text-gray-400">Late Arrivals</p>
                <p class="text-2xl font-bold">23</p>
              </div>
            </div>
            <div class="h-64">
              <canvas id="attendanceChart"></canvas>
            </div>
          </div>

          <!-- Feature 2: Attendance Trend Analyzer -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Attendance Trend Analyzer</h2>
            <div class="h-64">
              <canvas id="attendanceTrendChart"></canvas>
            </div>
          </div>

          <!-- Feature 3: Absenteeism Risk Forecast -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Absenteeism Risk Forecast</h2>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center">
                    <iconify-icon icon="ph:users-three-duotone" class="text-red-500"></iconify-icon>
                  </div>
                  <div>
                    <p class="font-medium">Sales Department</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">High risk: 24%</p>
                  </div>
                </div>
                <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                  <div class="bg-red-500 h-2 rounded-full" style="width: 75%"></div>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900 flex items-center justify-center">
                    <iconify-icon icon="ph:users-three-duotone" class="text-amber-500"></iconify-icon>
                  </div>
                  <div>
                    <p class="font-medium">Marketing Department</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Medium risk: 16%</p>
                  </div>
                </div>
                <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                  <div class="bg-amber-500 h-2 rounded-full" style="width: 50%"></div>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                    <iconify-icon icon="ph:users-three-duotone" class="text-green-500"></iconify-icon>
                  </div>
                  <div>
                    <p class="font-medium">Engineering Department</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Low risk: 8%</p>
                  </div>
                </div>
                <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                  <div class="bg-green-500 h-2 rounded-full" style="width: 25%"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature 4: Workforce Stability Index -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Workforce Stability Index</h2>
            <div class="flex items-center justify-center">
              <div class="relative w-48 h-48">
                <canvas id="stabilityGauge"></canvas>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                  <span class="text-3xl font-bold">87.4%</span>
                  <span class="text-sm text-gray-500 dark:text-gray-400">Stability</span>
                </div>
              </div>
            </div>
            <div class="grid grid-cols-3 gap-4 mt-4 text-center">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Attendance</p>
                <p class="font-bold">92.1%</p>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Schedule Adherence</p>
                <p class="font-bold">88.7%</p>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Leave Consistency</p>
                <p class="font-bold">81.4%</p>
              </div>
            </div>
          </div>

          <!-- Feature 5: Predictive Turnover Visualization -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Predictive Turnover Visualization</h2>
            <div class="h-64">
              <canvas id="turnoverChart"></canvas>
            </div>
          </div>

          <!-- Feature 6: Overtime Utilization Insights -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Overtime Utilization Insights</h2>
            <div class="h-64">
              <canvas id="overtimeChart"></canvas>
            </div>
          </div>

          <!-- Feature 7: Departmental Productivity Comparison -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Departmental Productivity Comparison</h2>
            <div class="h-64">
              <canvas id="productivityChart"></canvas>
            </div>
          </div>

          <!-- Feature 8: Payroll Cost Forecasting -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Payroll Cost Forecasting</h2>
            <div class="h-64">
              <canvas id="payrollChart"></canvas>
            </div>
          </div>

          <!-- Feature 9: Salary-to-Attendance Correlation (moved here for balance) -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Salary-to-Attendance Correlation</h2>
            <div class="h-64">
              <canvas id="salaryAttendanceChart"></canvas>
            </div>
          </div>

          <!-- Feature 12: Peak Attendance Window (moved here for balance) -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Peak Attendance Window</h2>
            <div class="h-64">
              <canvas id="peakAttendanceChart"></canvas>
            </div>
          </div>

        </div>

        <!-- Right Column -->
        <div class="space-y-6">
            <!-- Feature 10: Leave Pattern Analytics -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Leave Pattern Analytics</h2>
            <div class="h-64">
              <canvas id="leavePatternChart"></canvas>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-4">
              <div class="p-3 bg-amber-50 dark:bg-amber-900/30 rounded-lg">
                <p class="text-sm font-medium">Frequent Friday Absences</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">12 employees identified</p>
              </div>
              <div class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                <p class="text-sm font-medium">Extended Weekend Patterns</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">7 employees identified</p>
              </div>
            </div>
          </div>

          <!-- Feature 11: Late Arrival Heatmap -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Late Arrival Heatmap</h2>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-center">
                <thead>
                  <tr>
                    <th class="p-2"></th>
                    <th class="p-2">Mon</th>
                    <th class="p-2">Tue</th>
                    <th class="p-2">Wed</th>
                    <th class="p-2">Thu</th>
                    <th class="p-2">Fri</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="p-2 text-left">8:00-9:00</td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-red-500/80 rounded" title="12 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-red-500/60 rounded" title="9 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-amber-500/70 rounded" title="7 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-red-500/80 rounded" title="11 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-red-500/90 rounded" title="15 late arrivals"></div></td>
                  </tr>
                  <tr>
                    <td class="p-2 text-left">9:00-10:00</td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-amber-500/50 rounded" title="5 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/40 rounded" title="3 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/30 rounded" title="2 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-amber-500/60 rounded" title="6 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-amber-500/70 rounded" title="7 late arrivals"></div></td>
                  </tr>
                  <tr>
                    <td class="p-2 text-left">10:00-11:00</td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/20 rounded" title="1 late arrival"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/10 rounded" title="0 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/10 rounded" title="0 late arrivals"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/20 rounded" title="1 late arrival"></div></td>
                    <td class="p-2"><div class="heat-cell w-8 h-8 mx-auto bg-green-500/30 rounded" title="2 late arrivals"></div></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="flex items-center justify-center mt-4 gap-4">
              <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-green-500/10 rounded"></div>
                <span class="text-xs">0-2</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-amber-500/50 rounded"></div>
                <span class="text-xs">3-7</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-4 h-4 bg-red-500/80 rounded"></div>
                <span class="text-xs">8+</span>
              </div>
            </div>
          </div>

          <!-- Feature 13: AI-Powered HR Insight Summaries -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">AI-Powered HR Insight Summaries</h2>
            <div class="space-y-4">
              <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                <div class="flex items-start gap-3">
                  <iconify-icon icon="ph:trend-up-duotone" class="text-blue-500 mt-1"></iconify-icon>
                  <div>
                    <p class="font-medium">Department A's attendance consistency improved by 12% this quarter.</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The implementation of flexible scheduling has shown positive results.</p>
                  </div>
                </div>
              </div>
              <div class="p-4 bg-amber-50 dark:bg-amber-900/30 rounded-xl">
                <div class="flex items-start gap-3">
                  <iconify-icon icon="ph:warning-duotone" class="text-amber-500 mt-1"></iconify-icon>
                  <div>
                    <p class="font-medium">Sales team shows 24% higher absenteeism risk than company average.</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Consider reviewing workload distribution and support resources.</p>
                  </div>
                </div>
              </div>
              <div class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl">
                <div class="flex items-start gap-3">
                  <iconify-icon icon="ph:check-circle-duotone" class="text-green-500 mt-1"></iconify-icon>
                  <div>
                    <p class="font-medium">Engineering department maintains 96% schedule adherence.</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">This is 8% above the organizational benchmark.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature 14: Employee Consistency Scorecard -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Employee Consistency Scorecard</h2>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-200 dark:border-gray-700">
                    <th class="text-left p-3">Employee</th>
                    <th class="text-center p-3">Attendance</th>
                    <th class="text-center p-3">Punctuality</th>
                    <th class="text-center p-3">Consistency</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="p-3">Michael Chen</td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">98%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-green-500 h-2 rounded-full" style="width: 98%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">94%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-green-500 h-2 rounded-full" style="width: 94%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <span class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full">Excellent</span>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="p-3">Sarah Johnson</td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">92%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-amber-500 h-2 rounded-full" style="width: 92%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">88%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-amber-500 h-2 rounded-full" style="width: 88%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <span class="px-2 py-1 bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 text-xs rounded-full">Good</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="p-3">David Wilson</td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">84%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-red-500 h-2 rounded-full" style="width: 84%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <div class="flex items-center justify-center">
                        <span class="mr-2">76%</span>
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="bg-red-500 h-2 rounded-full" style="width: 76%"></div>
                        </div>
                      </div>
                    </td>
                    <td class="p-3 text-center">
                      <span class="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs rounded-full">Needs Improvement</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Feature 15: Comparative Analytics by Role/Department -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Comparative Analytics by Role/Department</h2>
            <div class="flex items-center gap-4 mb-4">
              <button class="px-4 py-2 rounded-lg glass text-sm bg-accent text-white">By Department</button>
              <button class="px-4 py-2 rounded-lg glass text-sm">By Role</button>
              <button class="px-4 py-2 rounded-lg glass text-sm">By Seniority</button>
            </div>
            <div class="h-64">
              <canvas id="comparativeChart"></canvas>
            </div>
          </div>

          <!-- Feature 16: Predictive Scheduling Assistance -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Predictive Scheduling Assistance</h2>
            <div class="space-y-4">
              <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                <p class="font-medium">AI Recommendation for Next Week</p>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Based on historical patterns, we recommend adding 2 additional staff to the morning shift on Tuesday and Thursday.</p>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div class="p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                  <p class="text-sm font-medium">Optimal Shift Coverage</p>
                  <p class="text-2xl font-bold">94%</p>
                </div>
                <div class="p-3 bg-amber-50 dark:bg-amber-900/30 rounded-lg">
                  <p class="text-sm font-medium">Understaffing Risk</p>
                  <p class="text-2xl font-bold">6%</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature 17: Salary Projection Dashboard -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Salary Projection Dashboard</h2>
            <div class="h-64">
              <canvas id="salaryProjectionChart"></canvas>
            </div>
          </div>

          <!-- Feature 18: Historical Workforce Timeline -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Historical Workforce Timeline</h2>
            <div class="h-64">
              <canvas id="historicalTimelineChart"></canvas>
            </div>
          </div>

          <!-- Feature 19: Anomaly Detection Panel -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Anomaly Detection Panel</h2>
            <div class="space-y-4">
              <div class="flex items-start p-4 bg-red-50 dark:bg-red-900/30 rounded-xl">
                <iconify-icon icon="ph:warning-circle-duotone" class="text-red-500 mt-1 mr-3"></iconify-icon>
                <div>
                  <p class="font-medium">Duplicate attendance logs detected</p>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Employee ID 8472 has multiple check-ins within 5 minutes on 3 occasions this week.</p>
                </div>
              </div>
              <div class="flex items-start p-4 bg-amber-50 dark:bg-amber-900/30 rounded-xl">
                <iconify-icon icon="ph:warning-duotone" class="text-amber-500 mt-1 mr-3"></iconify-icon>
                <div>
                  <p class="font-medium">Excessive absences flagged</p>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Department C shows 42% higher absence rate compared to last month.</p>
                </div>
              </div>
              <div class="flex items-start p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                <iconify-icon icon="ph:info-duotone" class="text-blue-500 mt-1 mr-3"></iconify-icon>
                <div>
                  <p class="font-medium">Payroll anomaly detected</p>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Unexpected 18% increase in overtime payments this pay period.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature 20: Exportable Analytics Report Generator -->
          <div class="glass rounded-3xl p-6 shadow-lg reveal">
            <h2 class="text-xl font-bold mb-4">Exportable Analytics Report Generator</h2>
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl text-center">
                  <iconify-icon icon="ph:file-pdf-duotone" class="text-3xl text-blue-500"></iconify-icon>
                  <p class="font-medium mt-2">PDF Report</p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Formal presentation format</p>
                  <button class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg text-sm ripple">Generate PDF</button>
                </div>
                <div class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl text-center">
                  <iconify-icon icon="ph:file-csv-duotone" class="text-3xl text-green-500"></iconify-icon>
                  <p class="font-medium mt-2">CSV Data Export</p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Raw data for analysis</p>
                  <button class="mt-3 px-4 py-2 bg-green-500 text-white rounded-lg text-sm ripple">Export CSV</button>
                </div>
              </div>
              <div class="p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl">
                <p class="font-medium">Custom Report Options</p>
                <div class="mt-2 space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="include-charts" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-3" checked>
                    <label for="include-charts" class="text-sm text-gray-700 dark:text-gray-300">Include charts and visualizations</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="include-ai-insights" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-3" checked>
                    <label for="include-ai-insights" class="text-sm text-gray-700 dark:text-gray-300">Include AI-generated insights</label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="include-raw-data" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-3">
                    <label for="include-raw-data" class="text-sm text-gray-700 dark:text-gray-300">Include raw data tables</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="pb-8 pt-2 text-xs text-gray-500 dark:text-gray-400 text-center">© IntelliHRTrack • AI Workforce Analytics Dashboard</footer>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize all charts
    document.addEventListener('DOMContentLoaded', function() {
      // Chart 1: Workforce Analytics Dashboard
      const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
      new Chart(attendanceCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [
            {
              label: 'Attendance Rate',
              data: [92, 94, 93, 95, 96, 94],
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'Productivity',
              data: [85, 87, 86, 89, 90, 88],
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.3,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              min: 80,
              max: 100
            }
          }
        }
      });

      // Chart 2: Attendance Trend Analyzer
      const trendCtx = document.getElementById('attendanceTrendChart').getContext('2d');
      new Chart(trendCtx, {
        type: 'bar',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [
            {
              label: 'Present',
              data: [92, 94, 96, 93],
              backgroundColor: '#10b981',
            },
            {
              label: 'Absent',
              data: [5, 4, 2, 5],
              backgroundColor: '#ef4444',
            },
            {
              label: 'Late',
              data: [3, 2, 2, 2],
              backgroundColor: '#f59e0b',
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            x: {
              stacked: true,
            },
            y: {
              stacked: true,
              max: 100
            }
          }
        }
      });

      // Chart 5: Predictive Turnover Visualization
      const turnoverCtx = document.getElementById('turnoverChart').getContext('2d');
      new Chart(turnoverCtx, {
        type: 'doughnut',
        data: {
          labels: ['Low Risk', 'Medium Risk', 'High Risk'],
          datasets: [{
            data: [65, 25, 10],
            backgroundColor: [
              '#10b981',
              '#f59e0b',
              '#ef4444'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Chart 6: Overtime Utilization Insights
      const overtimeCtx = document.getElementById('overtimeChart').getContext('2d');
      new Chart(overtimeCtx, {
        type: 'bar',
        data: {
          labels: ['Sales', 'Marketing', 'Engineering', 'HR', 'Finance'],
          datasets: [{
            label: 'Overtime Hours',
            data: [120, 85, 65, 45, 30],
            backgroundColor: '#8b5cf6',
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      // Chart 7: Departmental Productivity Comparison
      const productivityCtx = document.getElementById('productivityChart').getContext('2d');
      new Chart(productivityCtx, {
        type: 'radar',
        data: {
          labels: ['Attendance', 'Punctuality', 'Output', 'Quality', 'Collaboration'],
          datasets: [
            {
              label: 'Sales',
              data: [85, 78, 92, 80, 75],
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.2)',
            },
            {
              label: 'Engineering',
              data: [95, 92, 88, 94, 85],
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.2)',
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });

      // Chart 8: Payroll Cost Forecasting
      const payrollCtx = document.getElementById('payrollChart').getContext('2d');
      new Chart(payrollCtx, {
        type: 'line',
        data: {
          labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q1 Forecast', 'Q2 Forecast'],
          datasets: [{
            label: 'Payroll Costs ($)',
            data: [450000, 465000, 480000, 495000, 510000, 525000],
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            borderDash: [5, 5],
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      // Chart 9: Salary-to-Attendance Correlation
      const salaryAttendanceCtx = document.getElementById('salaryAttendanceChart').getContext('2d');
      new Chart(salaryAttendanceCtx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'Employees',
            data: [
              {x: 85, y: 45000},
              {x: 92, y: 52000},
              {x: 78, y: 38000},
              {x: 95, y: 65000},
              {x: 88, y: 48000},
              {x: 90, y: 55000},
              {x: 82, y: 42000},
              {x: 96, y: 72000},
              {x: 87, y: 46000},
              {x: 94, y: 58000}
            ],
            backgroundColor: '#8b5cf6',
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Attendance Rate (%)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Salary ($)'
              }
            }
          }
        }
      });

      // Chart 10: Leave Pattern Analytics
      const leavePatternCtx = document.getElementById('leavePatternChart').getContext('2d');
      new Chart(leavePatternCtx, {
        type: 'polarArea',
        data: {
          labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
          datasets: [{
            data: [12, 8, 6, 9, 18],
            backgroundColor: [
              '#ef4444',
              '#f59e0b',
              '#10b981',
              '#3b82f6',
              '#8b5cf6'
            ],
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        }
      });

      // Chart 12: Peak Attendance Window
      const peakAttendanceCtx = document.getElementById('peakAttendanceChart').getContext('2d');
      new Chart(peakAttendanceCtx, {
        type: 'line',
        data: {
          labels: ['6 AM', '8 AM', '10 AM', '12 PM', '2 PM', '4 PM', '6 PM'],
          datasets: [{
            label: 'Employee Count',
            data: [15, 85, 92, 88, 84, 76, 25],
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      // Chart 15: Comparative Analytics
      const comparativeCtx = document.getElementById('comparativeChart').getContext('2d');
      new Chart(comparativeCtx, {
        type: 'bar',
        data: {
          labels: ['Sales', 'Marketing', 'Engineering', 'HR', 'Finance'],
          datasets: [
            {
              label: 'Attendance',
              data: [88, 92, 96, 94, 90],
              backgroundColor: '#10b981',
            },
            {
              label: 'Productivity',
              data: [82, 85, 92, 88, 86],
              backgroundColor: '#8b5cf6',
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        }
      });

      // Chart 17: Salary Projection
      const salaryProjectionCtx = document.getElementById('salaryProjectionChart').getContext('2d');
      new Chart(salaryProjectionCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
          datasets: [
            {
              label: 'Actual',
              data: [450000, 465000, 480000, 495000, null, null, null, null],
              borderColor: '#10b981',
              tension: 0.3,
            },
            {
              label: 'Projected',
              data: [null, null, null, 495000, 510000, 525000, 540000, 555000],
              borderColor: '#8b5cf6',
              borderDash: [5, 5],
              tension: 0.3,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        }
      });

      // Chart 18: Historical Workforce Timeline
      const historicalCtx = document.getElementById('historicalTimelineChart').getContext('2d');
      new Chart(historicalCtx, {
        type: 'line',
        data: {
          labels: ['2019', '2020', '2021', '2022', '2023'],
          datasets: [
            {
              label: 'Workforce Size',
              data: [120, 135, 142, 155, 168],
              borderColor: '#10b981',
              yAxisID: 'y',
              tension: 0.3,
            },
            {
              label: 'Absenteeism Rate',
              data: [8.2, 9.5, 7.8, 6.9, 5.4],
              borderColor: '#ef4444',
              yAxisID: 'y1',
              tension: 0.3,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              grid: {
                drawOnChartArea: false,
              },
            }
          }
        }
      });

      // Workforce Stability Index Gauge
      const stabilityCtx = document.getElementById('stabilityGauge').getContext('2d');
      new Chart(stabilityCtx, {
        type: 'doughnut',
        data: {
          datasets: [{
            data: [87.4, 12.6],
            backgroundColor: [
              '#10b981',
              '#e5e7eb'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '75%',
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: false
            }
          }
        }
      });

      // Dark mode toggle
      const themeToggle = document.getElementById('themeToggle');
      
      themeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        
        // Update icon based on current theme
        const isDark = document.documentElement.classList.contains('dark');
        localStorage.setItem('ih_theme', isDark ? 'dark' : 'light');
      });
      
      // Check for saved theme preference or respect OS setting
      if (localStorage.getItem('ih_theme') === 'dark' || (!('ih_theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }

      // Clock functionality
      const headerClock = document.getElementById('headerClock');
      function updateClock(){ if(headerClock) headerClock.textContent = new Date().toLocaleTimeString(); }
      setInterval(updateClock, 1000); 
      updateClock();
      
      // Network status
      const netDot = document.getElementById('netDot');
      function updateNet(){ 
        const on = navigator.onLine; 
        if(netDot){ 
          netDot.classList.toggle('bg-green-500', on); 
          netDot.classList.toggle('bg-rose-500', !on); 
          netDot.title = on ? 'Online' : 'Offline'; 
        } 
      }
      window.addEventListener('online', updateNet); 
      window.addEventListener('offline', updateNet); 
      updateNet();

      // Add micro-interactions
      Array.from(document.querySelectorAll('.glass')).forEach(el=> el.classList.add('hover-lift'));
      Array.from(document.querySelectorAll('button')).forEach(el=> el.classList.add('ripple'));

      // Add reveal animations
      const revealables = Array.from(document.querySelectorAll('.reveal'));
      const io = new IntersectionObserver(entries=>{
        entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('in-view'); io.unobserve(en.target); } });
      }, { threshold: 0.12 });
      revealables.forEach(el=> io.observe(el));
    });
  </script>
<script>
    // Sidebar wiring: restore width, add resizer, mobile drawer and theme persistence
    document.addEventListener('DOMContentLoaded', function() {
      const aside = document.querySelector('aside[data-resizable]');
      const main = document.querySelector('main');

      // restore sidebar width
      try {
        const saved = localStorage.getItem('ih_sidebar_w');
        if (aside && saved) {
          aside.style.width = saved + 'px';
          if (main) main.style.marginLeft = saved + 'px';
        }
      } catch (e) {}

      // resizer
      if (aside) {
        const r = document.createElement('div');
        r.className = 'hidden lg:block';
        Object.assign(r.style, { position: 'absolute', top: '0', right: '0', width: '8px', height: '100%', cursor: 'ew-resize', zIndex: 60 });
        aside.style.position = 'fixed';
        aside.appendChild(r);

        let drag = false;
        r.addEventListener('mousedown', ()=>{ drag = true; document.body.style.userSelect = 'none'; });
        window.addEventListener('mousemove', (e)=>{
          if(!drag) return;
          const min=220, max=420; const newW = Math.min(max, Math.max(min, e.clientX));
          aside.style.width = newW + 'px';
          if(main) main.style.marginLeft = newW + 'px';
        });
        window.addEventListener('mouseup', ()=>{ if(drag){ drag=false; document.body.style.userSelect=''; try{ localStorage.setItem('ih_sidebar_w', parseInt(aside.style.width)); }catch(e){} } });
      }

      // theme persistence: reuse existing toggle if present
      const themeToggle = document.getElementById('themeToggle');
      const sidebarThemeToggle = document.getElementById('sidebarThemeToggle');
      function applyTheme(t){ if(t==='dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }
      try { const s = localStorage.getItem('ih_theme'); if(s) applyTheme(s); }
      catch(e){}
      function toggleTheme(){ const isDark = document.documentElement.classList.toggle('dark'); try{ localStorage.setItem('ih_theme', isDark ? 'dark' : 'light'); }catch(e){} }
      if(themeToggle) themeToggle.addEventListener('click', toggleTheme);
      if(sidebarThemeToggle) sidebarThemeToggle.addEventListener('click', toggleTheme);

      // mobile drawer button inserted into hero header
      const header = document.querySelector('header');
      if(header && aside){
        const mobileBtn = document.createElement('button');
        mobileBtn.className = 'lg:hidden p-2 rounded-md glass mr-3';
        mobileBtn.innerHTML = '<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>';
        header.insertBefore(mobileBtn, header.firstChild);
        mobileBtn.addEventListener('click', ()=>{
          const overlay = document.createElement('div'); overlay.className='fixed inset-0 z-50 bg-black/40 flex lg:hidden';
          const panel = document.createElement('aside'); panel.className='w-72 h-full overflow-y-auto p-4 bg-white dark:bg-gray-800';
          const brand = aside.querySelector('div'); const nav = aside.querySelector('nav'); if(brand) panel.appendChild(brand.cloneNode(true)); if(nav) panel.appendChild(nav.cloneNode(true));
          const foot = document.createElement('div'); foot.className='mt-4 p-2'; const footBtn = document.createElement('button'); footBtn.className='w-full px-3 py-2 rounded-xl glass'; footBtn.textContent='Toggle Theme'; footBtn.addEventListener('click', ()=> toggleTheme()); foot.appendChild(footBtn); panel.appendChild(foot);
          const closeBtn = document.createElement('button'); closeBtn.className='absolute top-4 right-4 p-2 rounded-full glass'; closeBtn.innerHTML='<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
          closeBtn.addEventListener('click', ()=> document.body.removeChild(overlay)); overlay.appendChild(panel); overlay.appendChild(closeBtn); overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) document.body.removeChild(overlay); }); document.body.appendChild(overlay);
        });
      }
    });
  </script>
<script>
    // Sidebar active link highlighter (matches current filename)
    (function(){
      try{
        const current = location.pathname.split('/').pop();
        const links = document.querySelectorAll('aside nav a[href]');
        links.forEach(a=>{
          const href = a.getAttribute('href') || '';
          const name = href.split('/').pop();
          if(name === current){ a.classList.add('ring','ring-white/30','bg-accent/10'); a.setAttribute('aria-current','page'); }
        });
      }catch(e){}
    })();
  </script>
{% endblock %}
